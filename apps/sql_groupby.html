<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZT6JM33V5J"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-ZT6JM33V5J');
        </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL GroupBy Visualizer</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
        }
        
        /* Custom Tailwind Colors */
        .bg-main { background-color: #101827; }
        .bg-panel { background-color: #1f2937; }
        .text-primary { color: #f3f4f6; }
        .text-secondary { color: #9ca3af; }
        .border-custom { border-color: #374151; }
        .accent { color: #8b5cf6; }
        .accent-bg { background-color: #8b5cf6; }
        .accent-hover:hover { background-color: #a78bfa; }
        
        /* Animation for row highlighting and convergence */
        .highlight-row {
            background-color: #8b5cf6 !important;
            transition: all 0.3s ease;
        }
        
        .fade-row {
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }
        
        .converge-row {
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.8s ease;
        }
        
        /* SQL Syntax Highlighting */
        .sql-keyword {
            color: #8b5cf6;
            font-weight: 500;
        }
        
        /* Custom scrollbar for tables */
        .table-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: #374151;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 4px;
        }
        
        /* Button states */
        .btn-primary {
            background-color: #8b5cf6;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover:not(:disabled) {
            background-color: #a78bfa;
        }
        
        .btn-primary:active:not(:disabled) {
            background-color: #7c3aed;
        }
        
        .btn-primary:disabled {
            background-color: #374151;
            color: #9ca3af;
            cursor: not-allowed;
        }
        
        .btn-ghost {
            background-color: transparent;
            border: 1px solid #8b5cf6;
            color: #8b5cf6;
            transition: all 0.2s ease;
        }
        
        .btn-ghost:hover {
            background-color: #1f2937;
        }
        
        /* Counter animation */
        .counter {
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        /* Responsive grid */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
        }
    </style>
</head>
<body class="bg-main text-primary min-h-screen flex flex-col">
    <!-- Header -->
    <header class="w-full py-6 border-b border-custom text-center">
        <h1 class="text-2xl font-bold">SQL GroupBy Visualizer</h1>
    </header>

    <!-- Main Content Grid -->
    <main class="flex-grow p-6">
        <div class="main-grid grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
            
            <!-- Left Panel: Controls -->
            <div class="bg-panel rounded-lg p-6 border border-custom">
                <div class="space-y-6">
                    
                    <!-- Section 1: Grouping Column -->
                    <div>
                        <label class="block text-sm font-medium mb-3 text-secondary">
                            1. GROUP BY
                        </label>
                        <select id="groupByColumn" class="w-full p-3 bg-main border border-custom rounded-lg text-primary focus:outline-none focus:border-[#8b5cf6]">
                            <option value="">Select column...</option>
                        </select>
                    </div>
                    
                    <!-- Section 2: Aggregation -->
                    <div>
                        <label class="block text-sm font-medium mb-3 text-secondary">
                            2. AGGREGATE
                        </label>
                        
                        <!-- Aggregate Function Radio Buttons -->
                        <div class="space-y-2 mb-4">
                            <label class="flex items-center">
                                <input type="radio" name="aggregateFunction" value="SUM" class="mr-2 accent-[#8b5cf6]">
                                <span>SUM()</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="aggregateFunction" value="COUNT" class="mr-2 accent-[#8b5cf6]">
                                <span>COUNT()</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="aggregateFunction" value="AVG" class="mr-2 accent-[#8b5cf6]">
                                <span>AVG()</span>
                            </label>
                        </div>
                        
                        <!-- Aggregate Column -->
                        <select id="aggregateColumn" class="w-full p-3 bg-main border border-custom rounded-lg text-primary focus:outline-none focus:border-[#8b5cf6]" disabled>
                            <option value="">Select column...</option>
                        </select>
                    </div>
                    
                    <!-- Section 3: Actions -->
                    <div class="space-y-3">
                        <button id="runQuery" class="w-full px-4 py-3 btn-primary text-white rounded-lg font-medium flex items-center justify-center gap-2" disabled>
                            <i class="fa-solid fa-play"></i>
                            Run Query
                        </button>
                        <button id="resetQuery" class="w-full px-4 py-3 btn-ghost rounded-lg font-medium flex items-center justify-center gap-2">
                            <i class="fa-solid fa-arrow-rotate-left"></i>
                            Reset
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Center Panel: Visualization -->
            <div class="bg-panel rounded-lg p-6 border border-custom">
                <div class="h-full flex flex-col">
                    <h3 class="text-lg font-medium mb-4 text-center">Data Visualization</h3>
                    
                    <!-- Source Table -->
                    <div class="mb-6">
                        <h4 class="text-sm font-medium mb-2 text-secondary">Source Table:</h4>
                        <div class="table-container overflow-auto max-h-64 border border-custom rounded">
                            <table id="sourceTable" class="w-full text-sm">
                                <thead class="bg-main sticky top-0">
                                    <tr id="sourceTableHeader"></tr>
                                </thead>
                                <tbody id="sourceTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Result Table -->
                    <div>
                        <h4 class="text-sm font-medium mb-2 text-secondary">Result Table:</h4>
                        <div class="table-container overflow-auto max-h-64 border border-custom rounded">
                            <table id="resultTable" class="w-full text-sm">
                                <thead class="bg-main">
                                    <tr id="resultTableHeader"></tr>
                                </thead>
                                <tbody id="resultTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: SQL Query -->
            <div class="bg-panel rounded-lg p-6 border border-custom">
                <h3 class="text-lg font-medium mb-4">SQL Query</h3>
                <div class="bg-main rounded-lg p-4 border border-custom">
                    <pre><code id="sqlQuery" class="text-sm leading-relaxed">SELECT
  <span class="text-secondary">column</span>,
  <span class="sql-keyword">FUNCTION</span>(<span class="text-secondary">column</span>) <span class="sql-keyword">AS</span> <span class="text-secondary">alias</span>
<span class="sql-keyword">FROM</span> <span class="text-secondary">table</span>
<span class="sql-keyword">GROUP BY</span>
  <span class="text-secondary">column</span>;</code></pre>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-panel border-t border-custom py-6 mt-auto">
        <div class="flex justify-center items-center space-x-6">
            <a href="https://www.linkedin.com/in/ashish-jangra/" target="_blank" class="text-secondary hover:text-[#a78bfa] transition-colors">
                <i class="fab fa-linkedin fa-2x"></i>
            </a>
            <a href="https://github.com/AshishJangra27" target="_blank" class="text-secondary hover:text-[#a78bfa] transition-colors">
                <i class="fab fa-github fa-2x"></i>
            </a>
            <a href="https://www.kaggle.com/ashishjangra27" target="_blank" class="text-secondary hover:text-[#a78bfa] transition-colors">
                <i class="fab fa-kaggle fa-2x"></i>
            </a>
            <a href="https://huggingface.co/ashish-jangra" target="_blank" class="text-secondary hover:text-[#a78bfa] transition-colors">
                <svg class="w-8 h-8 fill-current" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v-.07zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                </svg>
            </a>
            <a href="https://www.instagram.com/ashish_zangra/" target="_blank" class="text-secondary hover:text-[#a78bfa] transition-colors">
                <i class="fab fa-instagram fa-2x"></i>
            </a>
        </div>
    </footer>

    <script>
        // Sample data for the visualization
        const sampleData = [
            { Department: 'Sales', Region: 'North', Sales: 15000, Employees: 5 },
            { Department: 'Sales', Region: 'South', Sales: 12000, Employees: 4 },
            { Department: 'Marketing', Region: 'North', Sales: 8000, Employees: 3 },
            { Department: 'Marketing', Region: 'South', Sales: 9500, Employees: 3 },
            { Department: 'IT', Region: 'North', Sales: 20000, Employees: 8 },
            { Department: 'IT', Region: 'South', Sales: 18000, Employees: 7 },
            { Department: 'Sales', Region: 'East', Sales: 13500, Employees: 4 },
            { Department: 'Marketing', Region: 'East', Sales: 7000, Employees: 2 },
            { Department: 'IT', Region: 'East', Sales: 22000, Employees: 9 },
            { Department: 'HR', Region: 'North', Sales: 5000, Employees: 2 },
            { Department: 'HR', Region: 'South', Sales: 4500, Employees: 2 },
            { Department: 'HR', Region: 'East', Sales: 5500, Employees: 3 }
        ];

        // DOM elements
        const groupByColumn = document.getElementById('groupByColumn');
        const aggregateColumn = document.getElementById('aggregateColumn');
        const runQueryBtn = document.getElementById('runQuery');
        const resetQueryBtn = document.getElementById('resetQuery');
        const sqlQuery = document.getElementById('sqlQuery');
        const sourceTableHeader = document.getElementById('sourceTableHeader');
        const sourceTableBody = document.getElementById('sourceTableBody');
        const resultTableHeader = document.getElementById('resultTableHeader');
        const resultTableBody = document.getElementById('resultTableBody');

        // State management
        let currentAggregateFunction = null;
        let isAnimating = false;

        // Initialize the application
        function init() {
            populateColumnDropdowns();
            renderSourceTable();
            setupEventListeners();
            updateSQLQuery();
        }

        // Populate dropdown menus with column names
        function populateColumnDropdowns() {
            if (sampleData.length === 0) return;
            
            const columns = Object.keys(sampleData[0]);
            
            // Populate GROUP BY dropdown
            groupByColumn.innerHTML = '<option value="">Select column...</option>';
            columns.forEach(col => {
                const option = document.createElement('option');
                option.value = col;
                option.textContent = col;
                groupByColumn.appendChild(option);
            });
            
            // Populate AGGREGATE dropdown (only numeric columns for SUM/AVG)
            aggregateColumn.innerHTML = '<option value="">Select column...</option>';
            columns.forEach(col => {
                const option = document.createElement('option');
                option.value = col;
                option.textContent = col;
                aggregateColumn.appendChild(option);
            });
        }

        // Render the source data table
        function renderSourceTable() {
            if (sampleData.length === 0) return;
            
            const columns = Object.keys(sampleData[0]);
            
            // Create header
            sourceTableHeader.innerHTML = '';
            columns.forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                th.className = 'px-3 py-2 text-left border-b border-custom';
                sourceTableHeader.appendChild(th);
            });
            
            // Create rows
            sourceTableBody.innerHTML = '';
            sampleData.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.id = `source-row-${index}`;
                tr.className = 'border-b border-custom hover:bg-main/50';
                
                columns.forEach(col => {
                    const td = document.createElement('td');
                    td.textContent = row[col];
                    td.className = 'px-3 py-2';
                    tr.appendChild(td);
                });
                
                sourceTableBody.appendChild(tr);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Radio button change
            document.querySelectorAll('input[name="aggregateFunction"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    currentAggregateFunction = e.target.value;
                    
                    // Enable/disable aggregate column based on function
                    if (currentAggregateFunction === 'COUNT') {
                        aggregateColumn.disabled = true;
                        aggregateColumn.value = '*';
                    } else {
                        aggregateColumn.disabled = false;
                        aggregateColumn.value = '';
                    }
                    
                    updateRunButtonState();
                    updateSQLQuery();
                });
            });
            
            // Dropdown changes
            groupByColumn.addEventListener('change', () => {
                updateRunButtonState();
                updateSQLQuery();
            });
            
            aggregateColumn.addEventListener('change', () => {
                updateRunButtonState();
                updateSQLQuery();
            });
            
            // Button clicks
            runQueryBtn.addEventListener('click', runQuery);
            resetQueryBtn.addEventListener('click', resetQuery);
        }

        // Update run button state based on selections
        function updateRunButtonState() {
            const hasGroupBy = groupByColumn.value !== '';
            const hasAggregate = currentAggregateFunction !== null;
            const hasAggregateColumn = currentAggregateFunction === 'COUNT' || aggregateColumn.value !== '';
            
            runQueryBtn.disabled = !(hasGroupBy && hasAggregate && hasAggregateColumn) || isAnimating;
        }

        // Update SQL query display
        function updateSQLQuery() {
            const groupCol = groupByColumn.value || 'column';
            const aggFunc = currentAggregateFunction || 'FUNCTION';
            const aggCol = currentAggregateFunction === 'COUNT' ? '*' : (aggregateColumn.value || 'column');
            const alias = getAliasName(aggFunc, aggCol);
            
            const query = `<span class="sql-keyword">SELECT</span>
  ${groupCol},
  <span class="sql-keyword">${aggFunc}</span>(${aggCol}) <span class="sql-keyword">AS</span> ${alias}
<span class="sql-keyword">FROM</span> SalesData
<span class="sql-keyword">GROUP BY</span>
  ${groupCol};`;
            
            sqlQuery.innerHTML = query;
        }

        // Get appropriate alias name for aggregate function
        function getAliasName(func, col) {
            if (func === 'COUNT') return 'Count';
            if (func === 'SUM') return `Total${col}`;
            if (func === 'AVG') return `Average${col}`;
            return 'Result';
        }

        // Execute the GROUP BY operation with animation
        async function runQuery() {
            if (isAnimating) return;
            
            isAnimating = true;
            runQueryBtn.disabled = true;
            
            const groupCol = groupByColumn.value;
            const aggFunc = currentAggregateFunction;
            const aggCol = aggregateColumn.value || '*';
            
            // Clear previous results
            resultTableBody.innerHTML = '';
            
            // Create result table header
            const alias = getAliasName(aggFunc, aggCol);
            resultTableHeader.innerHTML = `
                <th class="px-3 py-2 text-left border-b border-custom">${groupCol}</th>
                <th class="px-3 py-2 text-left border-b border-custom">${alias}</th>
            `;
            
            // Group the data
            const groups = groupData(sampleData, groupCol);
            
            // Animate each group
            for (const [groupValue, groupRows] of Object.entries(groups)) {
                await animateGroup(groupValue, groupRows, groupCol, aggFunc, aggCol, alias);
            }
            
            isAnimating = false;
            updateRunButtonState();
        }

        // Group data by specified column
        function groupData(data, groupCol) {
            return data.reduce((groups, row, index) => {
                const key = row[groupCol];
                if (!groups[key]) {
                    groups[key] = [];
                }
                groups[key].push({ ...row, originalIndex: index });
                return groups;
            }, {});
        }

        // Animate a single group convergence
        async function animateGroup(groupValue, groupRows, groupCol, aggFunc, aggCol, alias) {
            // Highlight rows belonging to this group
            groupRows.forEach(row => {
                const rowElement = document.getElementById(`source-row-${row.originalIndex}`);
                rowElement.classList.add('highlight-row');
            });
            
            // Fade other rows
            sampleData.forEach((_, index) => {
                if (!groupRows.find(row => row.originalIndex === index)) {
                    const rowElement = document.getElementById(`source-row-${index}`);
                    rowElement.classList.add('fade-row');
                }
            });
            
            await sleep(800);
            
            // Calculate aggregate value
            const aggregateValue = calculateAggregate(groupRows, aggFunc, aggCol);
            
            // Create result row
            const resultRow = document.createElement('tr');
            resultRow.className = 'border-b border-custom';
            resultRow.innerHTML = `
                <td class="px-3 py-2">${groupValue}</td>
                <td class="px-3 py-2"><span class="counter">0</span></td>
            `;
            resultTableBody.appendChild(resultRow);
            
            // Animate counter
            const counter = resultRow.querySelector('.counter');
            await animateCounter(counter, aggregateValue);
            
            // Converge highlighted rows (visual effect)
            groupRows.forEach(row => {
                const rowElement = document.getElementById(`source-row-${row.originalIndex}`);
                rowElement.classList.add('converge-row');
            });
            
            await sleep(500);
            
            // Reset highlighting
            document.querySelectorAll('.highlight-row, .fade-row, .converge-row').forEach(el => {
                el.classList.remove('highlight-row', 'fade-row', 'converge-row');
            });
        }

        // Calculate aggregate value based on function
        function calculateAggregate(rows, func, col) {
            if (func === 'COUNT') {
                return rows.length;
            } else if (func === 'SUM') {
                return rows.reduce((sum, row) => sum + (row[col] || 0), 0);
            } else if (func === 'AVG') {
                const sum = rows.reduce((sum, row) => sum + (row[col] || 0), 0);
                return Math.round((sum / rows.length) * 100) / 100;
            }
            return 0;
        }

        // Animate counter to target value
        async function animateCounter(element, target) {
            const duration = 600;
            const steps = 30;
            const increment = target / steps;
            let current = 0;
            
            for (let i = 0; i <= steps; i++) {
                current = i === steps ? target : Math.round(current + increment);
                element.textContent = current;
                await sleep(duration / steps);
            }
        }

        // Reset the visualization
        function resetQuery() {
            // Clear selections
            groupByColumn.value = '';
            aggregateColumn.value = '';
            aggregateColumn.disabled = true;
            currentAggregateFunction = null;
            
            // Clear radio buttons
            document.querySelectorAll('input[name="aggregateFunction"]').forEach(radio => {
                radio.checked = false;
            });
            
            // Clear result table
            resultTableHeader.innerHTML = '';
            resultTableBody.innerHTML = '';
            
            // Reset source table appearance
            document.querySelectorAll('.highlight-row, .fade-row, .converge-row').forEach(el => {
                el.classList.remove('highlight-row', 'fade-row', 'converge-row');
            });
            
            // Update UI
            updateRunButtonState();
            updateSQLQuery();
        }

        // Utility function for delays
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
