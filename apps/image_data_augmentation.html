<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Data Augmentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #111827;
            color: #f3f4f6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .panel {
             background-color: #1f2937;
             border: 1px solid #374151;
        }
        .canvas-container {
             background-color: #111827;
             padding: 8px;
             border-radius: 0.5rem;
             border: 1px solid #374151;
             display: flex;
             align-items: center;
             justify-content: center;
        }
        canvas {
            image-rendering: pixelated;
            touch-action: none;
            background-color: black;
            border-radius: 4px;
            width: 100%;
            height: 100%;
        }
        .select-dropdown {
            background-color: #374151;
            border: 1px solid #4b5563;
        }
        .secondary-button {
            background-color: #be123c;
            color: white;
            transition: background-color: 0.2s ease;
        }
        .secondary-button:hover {
            background-color: #e11d48;
        }
        /* Custom slider styles */
        input[type="range"] {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 6px; background: #4b5563;
            border-radius: 5px; outline: none; opacity: 0.7; transition: opacity .2s;
        }
        input[type="range"]:hover { opacity: 1; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px; background: #6366f1;
            cursor: pointer; border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px; background: #6366f1;
            cursor: pointer; border-radius: 50%;
        }
        .footer {
            background-color: #1f2937;
            border-top: 1px solid #374151;
        }
        .footer-icon {
            transition: color 0.2s ease-in-out;
            color: #9ca3af;
        }
        .footer-icon:hover {
            color: #a78bfa;
        }

    </style>
</head>
<body class="flex flex-col p-4 lg:p-6">

    <!-- Header -->
    <header class="text-center mb-6 flex-shrink-0">
        <h1 class="text-3xl lg:text-4xl font-bold text-indigo-400">Image Data Augmentation</h1>
    </header>

    <!-- Main Content Layout -->
    <div class="w-full max-w-screen-2xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-6">
        
        <!-- Left Column: Original Image & Controls -->
        <div class="lg:col-span-1 flex flex-col gap-6">
            <!-- Combined Panel for Image and Controls -->
            <div class="panel p-4 rounded-xl shadow-2xl flex flex-col gap-4 flex-shrink-0">
                <h2 class="text-xl font-bold text-center text-gray-300">Original Image</h2>
                <div class="canvas-container aspect-square">
                    <canvas id="drawingCanvas"></canvas>
                </div>
                <button id="clearBtn" class="w-full secondary-button font-bold py-2 px-4 rounded-lg">Clear Canvas</button>

                <div class="border-t border-gray-700 my-2"></div>

                <h2 class="text-xl font-bold text-center text-gray-300">Controls</h2>
                <div class="relative">
                     <select id="augmentation-select" class="w-full select-dropdown text-white py-2.5 px-3 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-indigo-500">
                         <!-- Options generated by JS -->
                     </select>
                     <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                         <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                     </div>
                </div>

                <div id="advanced-controls-container" class="space-y-4 mt-4">
                    <!-- Controls will be dynamically inserted here -->
                     <div id="controls-placeholder" class="h-full flex items-center justify-center text-gray-500 text-center">Select an augmentation type to see its parameters.</div>
                </div>
            </div>
        </div>

        <!-- Right Column: Augmented Images -->
        <div class="lg:col-span-3 panel p-4 rounded-xl shadow-2xl">
             <h2 class="text-xl font-bold text-center text-gray-300 mb-4">Augmented Versions</h2>
             <div id="augmented-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-4">
                <!-- Canvases are generated by JS -->
             </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer w-full py-6 flex-shrink-0 mt-6">
        <div class="container mx-auto px-6 text-center text-gray-400">
            <div class="flex justify-center items-center space-x-6 mb-4">
                <a href="https://www.linkedin.com/in/ashish-jangra/" target="_blank" rel="noopener noreferrer" class="footer-icon">
                    <i class="fab fa-linkedin fa-2x"></i>
                </a>
                <a href="https://github.com/AshishJangra27" target="_blank" rel="noopener noreferrer" class="footer-icon">
                    <i class="fab fa-github fa-2x"></i>
                </a>
                 <a href="https://www.kaggle.com/ashishjangra27" target="_blank" rel="noopener noreferrer" class="footer-icon">
                    <i class="fab fa-kaggle fa-2x"></i>
                </a>
                <a href="https://huggingface.co/ashish-jangra" target="_blank" rel="noopener noreferrer" class="footer-icon">
                     <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block fill-current">
                        <path d="M20.24,12.2a8.24,8.24,0,1,1-16.48,0a8.24,8.24,0,0,1,16.48,0Z"></path>
                        <path d="M15.42,16.2c.18-.42.24-.84.18-1.26a4.55,4.55,0,0,0-.54-1.5,4.55,4.55,0,0,0-1.5-.54c-.42-.06-.84.06-1.26.18a4.55,4.55,0,0,0-1.5.54,4.55,4.55,0,0,0-.54,1.5c-.06.42.06.84.18,1.26a4.55,4.55,0,0,0,.54,1.5,4.55,4.55,0,0,0,1.5.54c.42.06.84,0,1.26-.18a4.55,4.55,0,0,0,1.5-.54,4.55,4.55,0,0,0,.54-1.5Z" fill="#111827"></path>
                        <path d="M10.26,10.26a1.44,1.44,0,1,1-2.88,0,1.44,1.44,0,0,1,2.88,0" fill="#111827"></path>
                        <path d="M16.62,10.26a1.44,1.44,0,1,1-2.88,0,1.44,1.44,0,0,1,2.88,0" fill="#111827"></path>
                    </svg>
                </a>
                 <a href="https://www.instagram.com/ashish_zangra/" target="_blank" rel="noopener noreferrer" class="footer-icon">
                    <i class="fab fa-instagram fa-2x"></i>
                </a>
            </div>
            <p class="text-sm">&copy; 2024 vizlearn. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configuration & Data ---
            const GRID_SIZE = 28;
            const AUGMENTATION_COUNT = 6;
            
            // --- DOM Elements ---
            const drawingCanvas = document.getElementById('drawingCanvas');
            const originalCtx = drawingCanvas.getContext('2d');
            const augmentationSelect = document.getElementById('augmentation-select');
            const augmentedGridContainer = document.getElementById('augmented-grid');
            const advancedControlsContainer = document.getElementById('advanced-controls-container');
            const controlsPlaceholder = document.getElementById('controls-placeholder');
            const clearBtn = document.getElementById('clearBtn');
            
            let augCanvases = {};
            let augContexts = {};

            // --- State ---
            let isDrawing = false;
            let originalGrid = [];
            let currentMode = 'none';
            let pixelSize = 0;

            // --- Initialization ---
            function initialize() {
                createAugmentationCanvases();
                createAugmentationDropdown();
                createAdvancedControls();
                originalGrid = createEmptyGrid();
                setupCanvases();
                clearAll();

                // --- Event Listeners ---
                clearBtn.addEventListener('click', clearAll);
                
                augmentationSelect.addEventListener('change', (e) => {
                    currentMode = e.target.value;
                    updateAdvancedControlsVisibility();
                    runCurrentModeAugmentation();
                });

                const onDrawStart = (e) => { isDrawing = true; draw(e); };
                const onDrawMove = (e) => { if(isDrawing) { draw(e) } };
                const onDrawEnd = () => {
                    if (isDrawing) {
                        isDrawing = false;
                        runCurrentModeAugmentation(); 
                    }
                };

                drawingCanvas.addEventListener('mousedown', onDrawStart);
                drawingCanvas.addEventListener('mousemove', onDrawMove);
                document.body.addEventListener('mouseup', onDrawEnd);
                drawingCanvas.addEventListener('mouseleave', onDrawEnd);
                drawingCanvas.addEventListener('touchstart', onDrawStart, { passive: false });
                drawingCanvas.addEventListener('touchmove', onDrawMove, { passive: false });
                document.body.addEventListener('touchend', onDrawEnd);
                
                window.addEventListener('resize', setupCanvases);
            }
            
            // --- UI Creation ---
            function createAugmentationCanvases() {
                for (let i = 0; i < AUGMENTATION_COUNT; i++) {
                    const id = `aug-canvas-${i}`;
                    const wrapper = document.createElement('div');
                    wrapper.className = 'flex flex-col items-center gap-2';
                    wrapper.innerHTML = `
                        <h3 id="aug-title-${i}" class="font-semibold text-gray-400 text-sm h-5">-</h3>
                        <div class="canvas-container w-full aspect-square">
                            <canvas id="${id}"></canvas>
                        </div>
                    `;
                    augmentedGridContainer.appendChild(wrapper);
                    augCanvases[i] = document.getElementById(id);
                    augContexts[i] = augCanvases[i].getContext('2d');
                }
            }
            
            const AUGMENTATION_DETAILS = {
                rotate: { min: -45, max: 45, value: 0, step: 1, unit: '°'},
                shift: { min: -7, max: 7, value: 0, step: 1, unit: 'px'},
                zoom: { min: 0.5, max: 1.5, value: 1, step: 0.05, unit: 'x'},
                shear: { min: -0.5, max: 0.5, value: 0, step: 0.05, unit: ''},
                noise: { min: 0, max: 200, value: 50, step: 5, unit: ''},
                contrast: { min: 0.1, max: 3, value: 1, step: 0.1, unit: 'x'},
                brightness: { min: -128, max: 128, value: 0, step: 8, unit: ''},
                cutout: { min: 2, max: 14, value: 8, step: 1, unit: 'px'},
            };

            function createAugmentationDropdown() {
                augmentationSelect.innerHTML = ''; 
                const placeholder = document.createElement('option');
                placeholder.value = 'none';
                placeholder.textContent = 'Select Augmentation...';
                augmentationSelect.appendChild(placeholder);

                for (const type in AUGMENTATION_DETAILS) {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                    augmentationSelect.appendChild(option);
                }
            }
            
            function setupCanvases() {
                const logicalSize = 224; 
                pixelSize = logicalSize / GRID_SIZE;
                [drawingCanvas, ...Object.values(augCanvases)].forEach(canvas => {
                    canvas.width = logicalSize;
                    canvas.height = logicalSize;
                });
                
                refreshOriginalDisplay();
                runCurrentModeAugmentation();
            }
            
            function clearAll() {
                originalGrid = createEmptyGrid();
                currentMode = 'none';
                augmentationSelect.value = 'none';
                updateAdvancedControlsVisibility();
                refreshOriginalDisplay();
                clearAugmentedDisplays();
            }
            
            function clearAugmentedDisplays() {
                for (let i = 0; i < AUGMENTATION_COUNT; i++) {
                    const ctx = augContexts[i];
                    ctx.clearRect(0, 0, augCanvases[i].width, augCanvases[i].height);
                    document.getElementById(`aug-title-${i}`).textContent = '-';
                }
            }
            
            function createEmptyGrid() {
                return Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(0));
            }

            function drawGridToCanvas(ctx, canvas, grid) {
                const pSize = canvas.width / GRID_SIZE;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        const intensity = grid[y][x];
                        ctx.fillStyle = `rgb(${intensity}, ${intensity}, ${intensity})`;
                        ctx.fillRect(x * pSize, y * pSize, pSize, pSize);
                    }
                }
            }
            
            function refreshOriginalDisplay() {
                drawGridToCanvas(originalCtx, drawingCanvas, originalGrid);
            }

            function draw(event) {
                event.preventDefault();
                const rect = drawingCanvas.getBoundingClientRect();
                const scaleX = drawingCanvas.width / rect.width;
                const scaleY = drawingCanvas.height / rect.height;

                const clientX = event.touches ? event.touches[0].clientX : event.clientX;
                const clientY = event.touches ? event.touches[0].clientY : event.clientY;

                const canvasX = (clientX - rect.left) * scaleX;
                const canvasY = (clientY - rect.top) * scaleY;
                
                const gridX = Math.floor(canvasX / pixelSize);
                const gridY = Math.floor(canvasY / pixelSize);

                const brushKernel = [[80, 160, 80], [160, 255, 160], [80, 160, 80]];
                const brushSize = 3;
                const brushOffset = Math.floor(brushSize / 2);

                for(let i = 0; i < brushSize; i++) {
                    for(let j = 0; j < brushSize; j++) {
                       const y = gridY + i - brushOffset;
                       const x = gridX + j - brushOffset;
                       if(y >= 0 && y < GRID_SIZE && x >= 0 && x < GRID_SIZE) {
                           originalGrid[y][x] = Math.min(255, originalGrid[y][x] + brushKernel[i][j]);
                       }
                    }
                }
                refreshOriginalDisplay();
            }
            
            function runCurrentModeAugmentation() {
                if (currentMode === 'none') {
                    return;
                };
                const source = JSON.parse(JSON.stringify(originalGrid));
                const funcs = {
                    'rotate':     () => generateVaryingAugmentation(source, applyRotation, 'angle', 60, '°'),
                    'shift':      () => generateVaryingAugmentation(source, applyShift, 'distance', 10, 'px'),
                    'zoom':       () => generateVaryingAugmentation(source, applyZoom, 'factor', 0.6, 'x'),
                    'shear':      () => generateVaryingAugmentation(source, applyShear, 'factor', 0.8, ''),
                    'noise':      () => generateVaryingAugmentation(source, applyNoise, 'amount', 150, ''),
                    'contrast':   () => generateVaryingAugmentation(source, applyContrast, 'factor', 2.0, 'x'),
                    'brightness': () => generateVaryingAugmentation(source, applyBrightness, 'amount', 200, ''),
                    'cutout':     () => generateVaryingAugmentation(source, applyCutout, 'size', 10, 'px'),
                };
                if (funcs[currentMode]) {
                    funcs[currentMode]();
                }
            }

            function generateVaryingAugmentation(source, applyFunc, paramName, spread, unit) {
                const slider = document.getElementById(`${currentMode}-slider`);
                const centerValue = slider ? parseFloat(slider.value) : 0;
                
                const dynamicMin = centerValue - (spread / 2);
                const step = spread / (AUGMENTATION_COUNT - 1);

                for (let i = 0; i < AUGMENTATION_COUNT; i++) {
                    const value = (AUGMENTATION_COUNT > 1) ? dynamicMin + i * step : centerValue;
                    let augmentedGrid;

                    if (paramName === 'distance') {
                         augmentedGrid = applyFunc(source, Math.round(value), Math.round(value));
                    } else {
                         augmentedGrid = applyFunc(source, value);
                    }
                    drawGridToCanvas(augContexts[i], augCanvases[i], augmentedGrid);
                    document.getElementById(`aug-title-${i}`).textContent = `${value.toFixed(1)}${unit}`;
                }
            }
            
            function createAdvancedControls() {
                 for (const type in AUGMENTATION_DETAILS) {
                    const params = AUGMENTATION_DETAILS[type];
                    const wrapper = document.createElement('div');
                    wrapper.id = `controls-${type}`;
                    wrapper.className = 'hidden flex-col gap-1';
                    wrapper.innerHTML = `
                        <div class="flex justify-between items-center text-sm">
                            <label for="${type}-slider" class="font-medium text-gray-300 capitalize">${type}</label>
                            <span id="${type}-value" class="font-mono text-indigo-400"></span>
                        </div>
                        <input type="range" id="${type}-slider" min="${params.min}" max="${params.max}" value="${params.value}" step="${params.step}">
                    `;
                    advancedControlsContainer.appendChild(wrapper);
                    
                    const slider = document.getElementById(`${type}-slider`);
                    const valueDisplay = document.getElementById(`${type}-value`);
                    
                    const updateUI = () => {
                        valueDisplay.textContent = `${parseFloat(slider.value).toFixed(2)}${params.unit}`;
                        runCurrentModeAugmentation();
                    };
                    
                    slider.addEventListener('input', updateUI);
                    valueDisplay.textContent = `${parseFloat(slider.value).toFixed(2)}${params.unit}`;
                 }
            }

            function updateAdvancedControlsVisibility() {
                const allControls = advancedControlsContainer.querySelectorAll('div[id^="controls-"]');
                allControls.forEach(c => c.classList.add('hidden'));
                
                if (currentMode !== 'none') {
                    controlsPlaceholder.classList.add('hidden');
                    const activeControls = document.getElementById(`controls-${currentMode}`);
                    if (activeControls) {
                        activeControls.classList.remove('hidden');
                    }
                } else {
                     controlsPlaceholder.classList.remove('hidden');
                }
            }
            
            // --- AUGMENTATION FUNCTIONS (minified) ---
            const clamp = (val, min, max) => Math.max(min, Math.min(val, max));
            function applyRotation(grid, angle) { const newGrid=createEmptyGrid(),rad=angle*Math.PI/180,cos=Math.cos(rad),sin=Math.sin(rad),cx=13.5,cy=13.5;for(let y=0;y<28;y++)for(let x=0;x<28;x++){const srcX=Math.round((x-cx)*cos-(y-cy)*sin+cx),srcY=Math.round((x-cx)*sin+(y-cy)*cos+cy);srcX>=0&&srcX<28&&srcY>=0&&srcY<28&&(newGrid[y][x]=grid[srcY][srcX])}return newGrid }
            function applyShift(grid, dx, dy) { const newGrid=createEmptyGrid();for(let y=0;y<28;y++)for(let x=0;x<28;x++){const srcX=x-Math.round(dx),srcY=y-Math.round(dy);srcX>=0&&srcX<28&&srcY>=0&&srcY<28&&(newGrid[y][x]=grid[srcY][srcX])}return newGrid }
            function applyZoom(grid, factor) { const newGrid=createEmptyGrid(),cx=13.5,cy=13.5;if(factor==0) return grid; for(let y=0;y<28;y++)for(let x=0;x<28;x++){const srcX=Math.round((x-cx)/factor+cx),srcY=Math.round((y-cy)/factor+cy);srcX>=0&&srcX<28&&srcY>=0&&srcY<28&&(newGrid[y][x]=grid[srcY][srcX])}return newGrid }
            function applyShear(grid, shearX) { const newGrid=createEmptyGrid(),cy=14;for(let y=0;y<28;y++)for(let x=0;x<28;x++){const srcX=Math.round(x+(y-cy)*shearX);srcX>=0&&srcX<28&&(newGrid[y][x]=grid[y][srcX])}return newGrid }
            function applyNoise(grid, amount) { const newGrid=createEmptyGrid();for(let y=0;y<28;y++)for(let x=0;x<28;x++){const noise=(Math.random()-.5)*amount;newGrid[y][x]=clamp(Math.round(grid[y][x]+noise),0,255)}return newGrid }
            function applyContrast(grid, factor) { const newGrid=createEmptyGrid();for(let y=0;y<28;y++)for(let x=0;x<28;x++){const newValue=factor*(grid[y][x]-128)+128;newGrid[y][x]=clamp(Math.round(newValue),0,255)}return newGrid }
            function applyBrightness(grid, amount) { const newGrid=createEmptyGrid();for(let y=0;y<28;y++)for(let x=0;x<28;x++)newGrid[y][x]=clamp(Math.round(grid[y][x]+amount),0,255);return newGrid }
            function applyCutout(grid, size) { const newGrid=JSON.parse(JSON.stringify(grid)),s=Math.round(size);if(s<=0)return newGrid;const startX=Math.floor(Math.random()*(28-s)),startY=Math.floor(Math.random()*(28-s));for(let y=startY;y<startY+s;y++)for(let x=startX;x<startX+s;x++)y<28&&x<28&&(newGrid[y][x]=0);return newGrid }
            
            // --- Run Initialization ---
            initialize();
        });
    </script>
</body>
</html>
