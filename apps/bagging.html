<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZT6JM33V5J"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-ZT6JM33V5J');
        </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Explainer: Bagging</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Custom theme configuration */
        body {
            font-family: 'Roboto Mono', monospace;
        }
        
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #374151;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #8b5cf6;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a78bfa;
        }
        
        /* Custom slider styling */
        .custom-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #374151;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #8b5cf6;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .custom-slider::-webkit-slider-thumb:hover {
            background: #a78bfa;
            transform: scale(1.1);
        }
        
        .custom-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #8b5cf6;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }
        
        .custom-slider::-moz-range-thumb:hover {
            background: #a78bfa;
            transform: scale(1.1);
        }
        
        /* Button styles */
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #a78bfa, #c4b5fd);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #374151;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }
        
        /* Canvas styling */
        canvas {
            border: 2px solid #374151;
            border-radius: 8px;
            background: #101827;
        }
        
        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Step indicator */
        .step-indicator {
            position: relative;
            padding: 8px 16px;
            border-radius: 20px;
            background: #374151;
            color: #9ca3af;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .step-indicator.active {
            background: #8b5cf6;
            color: #f3f4f6;
        }
        
        .step-indicator.completed {
            background: #10b981;
            color: #f3f4f6;
        }
        
        /* Grid layout for bootstrap samples */
        .bootstrap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 16px;
        }
        
        .bootstrap-canvas {
            width: 100%;
            height: 100px;
            border: 1px solid #374151;
            border-radius: 6px;
            background: #101827;
        }
        
        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #374151;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #a78bfa);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-[#101827] text-[#f3f4f6] flex flex-col min-h-screen">
    <!-- Header -->
    <header class="py-6 px-4 text-center border-b border-[#374151]">
        <h1 class="text-3xl md:text-4xl font-bold text-[#f3f4f6]">
            Interactive Explainer: Bagging
        </h1>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col lg:flex-row gap-6 p-6">
        <!-- Left Panel: Controls & Narrative -->
        <div class="lg:w-1/3 bg-[#1f2937] rounded-xl p-6 border border-[#374151]">
            <div class="h-full flex flex-col space-y-6">
                <!-- Parameters Section -->
                <div>
                    <h2 class="text-xl font-semibold mb-4 text-[#f3f4f6]">
                        <i class="fas fa-sliders-h text-[#8b5cf6] mr-2"></i>
                        Parameters
                    </h2>
                    
                    <!-- Number of Models Slider -->
                    <div class="mb-6">
                        <label class="text-sm font-medium text-[#f3f4f6] block mb-2">
                            Number of Models: <span id="numModelsValue" class="text-[#8b5cf6]">6</span>
                        </label>
                        <input 
                            type="range" 
                            id="numModelsSlider" 
                            class="custom-slider" 
                            min="3" 
                            max="12" 
                            value="6"
                        >
                        <div class="flex justify-between text-xs text-[#9ca3af] mt-1">
                            <span>3</span>
                            <span>6</span>
                            <span>9</span>
                            <span>12</span>
                        </div>
                    </div>
                    
                    <!-- Sample Size Slider -->
                    <div class="mb-6">
                        <label class="text-sm font-medium text-[#f3f4f6] block mb-2">
                            Sample Size: <span id="sampleSizeValue" class="text-[#8b5cf6]">80%</span>
                        </label>
                        <input 
                            type="range" 
                            id="sampleSizeSlider" 
                            class="custom-slider" 
                            min="50" 
                            max="100" 
                            value="80"
                        >
                        <div class="flex justify-between text-xs text-[#9ca3af] mt-1">
                            <span>50%</span>
                            <span>75%</span>
                            <span>100%</span>
                        </div>
                    </div>
                </div>

                <!-- Step Controls -->
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-[#f3f4f6]">
                        <i class="fas fa-play text-[#8b5cf6] mr-2"></i>
                        Controls
                    </h3>
                    
                    <div class="space-y-3">
                        <button 
                            id="generateDataBtn" 
                            class="btn-primary w-full py-3 px-4 rounded-lg font-medium text-white flex items-center justify-center"
                        >
                            <i class="fas fa-refresh mr-2"></i>
                            Generate New Data
                        </button>
                        
                        <button 
                            id="createSamplesBtn" 
                            class="btn-primary w-full py-3 px-4 rounded-lg font-medium text-white flex items-center justify-center"
                            disabled
                        >
                            <i class="fas fa-random mr-2"></i>
                            1. Create Samples (Bootstrap)
                        </button>
                        
                        <button 
                            id="trainModelsBtn" 
                            class="btn-primary w-full py-3 px-4 rounded-lg font-medium text-white flex items-center justify-center"
                            disabled
                        >
                            <i class="fas fa-brain mr-2"></i>
                            2. Train Weak Models
                        </button>
                        
                        <button 
                            id="aggregateBtn" 
                            class="btn-primary w-full py-3 px-4 rounded-lg font-medium text-white flex items-center justify-center"
                            disabled
                        >
                            <i class="fas fa-vote-yea mr-2"></i>
                            3. Aggregate Models (Vote)
                        </button>
                        
                        <div class="flex gap-2">
                            <button 
                                id="autoRunBtn" 
                                class="btn-secondary flex-1 py-3 px-4 rounded-lg font-medium text-[#f3f4f6] flex items-center justify-center"
                            >
                                <i class="fas fa-play mr-2"></i>
                                Auto-Run
                            </button>
                            
                            <button 
                                id="resetBtn" 
                                class="btn-secondary flex-1 py-3 px-4 rounded-lg font-medium text-[#f3f4f6] flex items-center justify-center"
                            >
                                <i class="fas fa-undo mr-2"></i>
                                Reset
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Progress Indicator -->
                <div>
                    <h4 class="text-sm font-semibold text-[#a78bfa] mb-2">Progress</h4>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <div class="flex justify-between mt-2 text-xs">
                        <span id="step1" class="step-indicator">Data</span>
                        <span id="step2" class="step-indicator">Samples</span>
                        <span id="step3" class="step-indicator">Models</span>
                        <span id="step4" class="step-indicator">Ensemble</span>
                    </div>
                </div>

                <!-- Explanation Section -->
                <div class="bg-[#101827] border border-[#374151] rounded-lg p-4 flex-grow">
                    <h3 class="text-lg font-semibold mb-3 text-[#f3f4f6]">
                        <i class="fas fa-lightbulb text-[#8b5cf6] mr-2"></i>
                        How Bagging Works
                    </h3>
                    <div id="explanationText" class="text-[#9ca3af] text-sm leading-relaxed">
                        <p>
                            <strong class="text-[#f3f4f6]">Bagging (Bootstrap Aggregating)</strong> creates multiple models on different subsets of data to improve prediction accuracy and reduce overfitting.
                        </p>
                        <div class="mt-3 space-y-2 text-xs">
                            <div><strong class="text-[#a78bfa]">Bootstrap Sampling:</strong> Create multiple datasets by sampling with replacement</div>
                            <div><strong class="text-[#a78bfa]">Weak Learners:</strong> Train simple models on each bootstrap sample</div>
                            <div><strong class="text-[#a78bfa]">Aggregation:</strong> Combine predictions through voting or averaging</div>
                            <div><strong class="text-[#a78bfa]">Result:</strong> A more robust and accurate ensemble model</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Visualization -->
        <div class="lg:w-2/3 bg-[#1f2937] rounded-xl p-6 border border-[#374151]">
            <div class="h-full flex flex-col">
                <!-- Main Visualization Header -->
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-[#f3f4f6]">
                        <i class="fas fa-chart-scatter text-[#8b5cf6] mr-2"></i>
                        Bagging Visualization
                    </h2>
                    <div class="flex items-center space-x-4 text-sm">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-[#8b5cf6] mr-2"></div>
                            <span class="text-[#9ca3af]">Class A</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-[#10b981] mr-2"></div>
                            <span class="text-[#9ca3af]">Class B</span>
                        </div>
                    </div>
                </div>
                
                <!-- Main Dataset Canvas -->
                <div class="mb-4">
                    <h3 class="text-sm font-medium text-[#f3f4f6] mb-2">Original Dataset & Ensemble Model</h3>
                    <canvas 
                        id="mainCanvas" 
                        width="600" 
                        height="300"
                        class="w-full max-w-full"
                    ></canvas>
                </div>
                
                <!-- Bootstrap Samples Grid -->
                <div class="flex-grow">
                    <h3 class="text-sm font-medium text-[#f3f4f6] mb-2">
                        Bootstrap Samples & Weak Models
                        <span id="sampleCount" class="text-[#8b5cf6] ml-2">(0 samples)</span>
                    </h3>
                    <div id="bootstrapGrid" class="bootstrap-grid h-full overflow-auto">
                        <!-- Bootstrap sample canvases will be dynamically added here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-[#1f2937] border-t border-[#374151] py-6 mt-auto">
        <div class="flex justify-center space-x-6">
            <a href="https://www.linkedin.com/in/ashish-jangra/" target="_blank" rel="noopener noreferrer" 
               class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors duration-300">
                <i class="fab fa-linkedin fa-2x"></i>
            </a>
            <a href="https://github.com/AshishJangra27" target="_blank" rel="noopener noreferrer" 
               class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors duration-300">
                <i class="fab fa-github fa-2x"></i>
            </a>
            <a href="https://www.kaggle.com/ashishjangra27" target="_blank" rel="noopener noreferrer" 
               class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors duration-300">
                <i class="fab fa-kaggle fa-2x"></i>
            </a>
            <a href="https://huggingface.co/ashish-jangra" target="_blank" rel="noopener noreferrer" 
               class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors duration-300">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12.036 3L4.5 7.73v8.54l7.536 4.73 7.536-4.73V7.73L12.036 3zm5.157 3.74L12 10.5 6.807 6.74 12 4.73l5.193 2.01zm-5.157 12.72l-5.036-3.16V9.04L12 13.08l5.036-4.04v7.26L12.036 19.46z"/>
                </svg>
            </a>
            <a href="https://www.instagram.com/ashish_zangra/" target="_blank" rel="noopener noreferrer" 
               class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors duration-300">
                <i class="fab fa-instagram fa-2x"></i>
            </a>
        </div>
    </footer>

    <script>
        // Global variables
        let originalData = [];
        let bootstrapSamples = [];
        let weakModels = [];
        let ensembleModel = null;
        let currentStep = 0;
        let isAutoRunning = false;
        let autoRunInterval = null;
        
        // Canvas contexts
        let mainCanvas, mainCtx;
        let bootstrapCanvases = [];
        
        // Colors
        const colors = {
            classA: '#8b5cf6',
            classB: '#10b981',
            background: '#101827',
            border: '#374151',
            weakBoundary: 'rgba(243, 244, 246, 0.3)',
            ensembleBoundary: '#8b5cf6'
        };
        
        // DOM elements
        const numModelsSlider = document.getElementById('numModelsSlider');
        const numModelsValue = document.getElementById('numModelsValue');
        const sampleSizeSlider = document.getElementById('sampleSizeSlider');
        const sampleSizeValue = document.getElementById('sampleSizeValue');
        
        const generateDataBtn = document.getElementById('generateDataBtn');
        const createSamplesBtn = document.getElementById('createSamplesBtn');
        const trainModelsBtn = document.getElementById('trainModelsBtn');
        const aggregateBtn = document.getElementById('aggregateBtn');
        const autoRunBtn = document.getElementById('autoRunBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        const progressFill = document.getElementById('progressFill');
        const explanationText = document.getElementById('explanationText');
        const sampleCount = document.getElementById('sampleCount');
        const bootstrapGrid = document.getElementById('bootstrapGrid');
        
        // Initialize the application
        function init() {
            setupCanvas();
            setupEventListeners();
            updateSliderDisplays();
            generateData();
        }
        
        // Setup main canvas
        function setupCanvas() {
            mainCanvas = document.getElementById('mainCanvas');
            mainCtx = mainCanvas.getContext('2d');
            
            // Set canvas size
            const rect = mainCanvas.getBoundingClientRect();
            mainCanvas.width = 600;
            mainCanvas.height = 300;
        }
        
        // Setup event listeners
        function setupEventListeners() {
            numModelsSlider.addEventListener('input', updateSliderDisplays);
            sampleSizeSlider.addEventListener('input', updateSliderDisplays);
            
            generateDataBtn.addEventListener('click', generateData);
            createSamplesBtn.addEventListener('click', createBootstrapSamples);
            trainModelsBtn.addEventListener('click', trainWeakModels);
            aggregateBtn.addEventListener('click', aggregateModels);
            autoRunBtn.addEventListener('click', toggleAutoRun);
            resetBtn.addEventListener('click', resetVisualization);
            
            // Update sample count when sliders change
            numModelsSlider.addEventListener('input', updateSampleCount);
        }
        
        // Update slider displays
        function updateSliderDisplays() {
            numModelsValue.textContent = numModelsSlider.value;
            sampleSizeValue.textContent = sampleSizeSlider.value + '%';
        }
        
        // Update sample count display
        function updateSampleCount() {
            const count = bootstrapSamples.length || numModelsSlider.value;
            sampleCount.textContent = `(${count} samples)`;
        }
        
        // Generate random dataset
        function generateData() {
            originalData = [];
            const numPoints = 80;
            
            // Generate two clusters
            for (let i = 0; i < numPoints / 2; i++) {
                // Class A (purple) - centered around (150, 100)
                originalData.push({
                    x: 150 + (Math.random() - 0.5) * 120,
                    y: 100 + (Math.random() - 0.5) * 80,
                    class: 'A'
                });
                
                // Class B (green) - centered around (450, 200)
                originalData.push({
                    x: 450 + (Math.random() - 0.5) * 120,
                    y: 200 + (Math.random() - 0.5) * 80,
                    class: 'B'
                });
            }
            
            // Reset state
            bootstrapSamples = [];
            weakModels = [];
            ensembleModel = null;
            currentStep = 1;
            
            // Update UI
            drawMainCanvas();
            updateStepIndicator();
            updateProgress();
            updateExplanation();
            updateButtonStates();
            clearBootstrapGrid();
            updateSampleCount();
        }
        
        // Create bootstrap samples
        function createBootstrapSamples() {
            const numModels = parseInt(numModelsSlider.value);
            const sampleSizePercent = parseInt(sampleSizeSlider.value);
            const sampleSize = Math.floor(originalData.length * sampleSizePercent / 100);
            
            bootstrapSamples = [];
            
            for (let i = 0; i < numModels; i++) {
                const sample = [];
                
                // Bootstrap sampling with replacement
                for (let j = 0; j < sampleSize; j++) {
                    const randomIndex = Math.floor(Math.random() * originalData.length);
                    sample.push({ ...originalData[randomIndex] });
                }
                
                bootstrapSamples.push(sample);
            }
            
            // Create bootstrap sample canvases
            createBootstrapCanvases();
            
            // Animate sampling process
            animateBootstrapSampling();
            
            currentStep = 2;
            updateStepIndicator();
            updateProgress();
            updateExplanation();
            updateButtonStates();
            updateSampleCount();
        }
        
        // Create bootstrap sample canvases
        function createBootstrapCanvases() {
            bootstrapGrid.innerHTML = '';
            bootstrapCanvases = [];
            
            const numModels = parseInt(numModelsSlider.value);
            
            for (let i = 0; i < numModels; i++) {
                const canvasContainer = document.createElement('div');
                canvasContainer.className = 'fade-in';
                canvasContainer.style.animationDelay = `${i * 0.1}s`;
                
                const label = document.createElement('div');
                label.className = 'text-xs text-[#9ca3af] mb-1 text-center';
                label.textContent = `Model ${i + 1}`;
                
                const canvas = document.createElement('canvas');
                canvas.className = 'bootstrap-canvas';
                canvas.width = 120;
                canvas.height = 100;
                
                canvasContainer.appendChild(label);
                canvasContainer.appendChild(canvas);
                bootstrapGrid.appendChild(canvasContainer);
                
                bootstrapCanvases.push(canvas);
            }
        }
        
        // Animate bootstrap sampling
        function animateBootstrapSampling() {
            bootstrapSamples.forEach((sample, modelIndex) => {
                setTimeout(() => {
                    drawBootstrapSample(modelIndex, sample);
                }, modelIndex * 200);
            });
        }
        
        // Draw bootstrap sample on small canvas
        function drawBootstrapSample(modelIndex, sample) {
            const canvas = bootstrapCanvases[modelIndex];
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.fillStyle = colors.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Scale factor to fit data in smaller canvas
            const scaleX = (canvas.width - 20) / 600;
            const scaleY = (canvas.height - 20) / 300;
            
            // Draw sample points
            sample.forEach(point => {
                ctx.fillStyle = colors[`class${point.class}`];
                ctx.beginPath();
                ctx.arc(
                    point.x * scaleX + 10,
                    point.y * scaleY + 10,
                    2,
                    0,
                    2 * Math.PI
                );
                ctx.fill();
            });
        }
        
        // Train weak models
        function trainWeakModels() {
            weakModels = [];
            
            bootstrapSamples.forEach((sample, modelIndex) => {
                // Simple linear classifier (decision boundary)
                const model = trainSimpleClassifier(sample);
                weakModels.push(model);
                
                // Draw model on bootstrap canvas
                setTimeout(() => {
                    drawWeakModel(modelIndex, model);
                }, modelIndex * 300);
            });
            
            currentStep = 3;
            updateStepIndicator();
            updateProgress();
            updateExplanation();
            updateButtonStates();
        }
        
        // Train a simple linear classifier
        function trainSimpleClassifier(sample) {
            // Find centroids of each class
            const classA = sample.filter(p => p.class === 'A');
            const classB = sample.filter(p => p.class === 'B');
            
            if (classA.length === 0 || classB.length === 0) {
                // Fallback: random decision boundary
                return {
                    slope: (Math.random() - 0.5) * 2,
                    intercept: Math.random() * 300
                };
            }
            
            const centroidA = {
                x: classA.reduce((sum, p) => sum + p.x, 0) / classA.length,
                y: classA.reduce((sum, p) => sum + p.y, 0) / classA.length
            };
            
            const centroidB = {
                x: classB.reduce((sum, p) => sum + p.x, 0) / classB.length,
                y: classB.reduce((sum, p) => sum + p.y, 0) / classB.length
            };
            
            // Calculate perpendicular bisector
            const midX = (centroidA.x + centroidB.x) / 2;
            const midY = (centroidA.y + centroidB.y) / 2;
            
            const dx = centroidB.x - centroidA.x;
            const dy = centroidB.y - centroidA.y;
            
            const slope = dx !== 0 ? -dx / dy : Math.random() - 0.5;
            const intercept = midY - slope * midX;
            
            return { slope, intercept };
        }
        
        // Draw weak model decision boundary
        function drawWeakModel(modelIndex, model) {
            const canvas = bootstrapCanvases[modelIndex];
            const ctx = canvas.getContext('2d');
            
            const scaleX = (canvas.width - 20) / 600;
            const scaleY = (canvas.height - 20) / 300;
            
            // Draw decision boundary
            ctx.strokeStyle = colors.weakBoundary;
            ctx.lineWidth = 1;
            ctx.beginPath();
            
            const y1 = model.intercept * scaleY + 10;
            const y2 = (model.slope * 600 + model.intercept) * scaleY + 10;
            
            ctx.moveTo(10, Math.max(0, Math.min(canvas.height, y1)));
            ctx.lineTo(canvas.width - 10, Math.max(0, Math.min(canvas.height, y2)));
            ctx.stroke();
        }
        
        // Aggregate models to create ensemble
        function aggregateModels() {
            // Draw weak models on main canvas first
            drawWeakModelsOnMain();
            
            // Create ensemble model by averaging predictions
            setTimeout(() => {
                ensembleModel = createEnsembleModel();
                drawEnsembleModel();
                
                currentStep = 4;
                updateStepIndicator();
                updateProgress();
                updateExplanation();
                updateButtonStates();
            }, 1000);
        }
        
        // Draw weak models on main canvas
        function drawWeakModelsOnMain() {
            weakModels.forEach((model, index) => {
                setTimeout(() => {
                    drawDecisionBoundary(model, colors.weakBoundary, 1);
                }, index * 200);
            });
        }
        
        // Create ensemble model
        function createEnsembleModel() {
            // For visualization, we'll create a smoother boundary
            // by sampling many points and using majority vote
            const gridPoints = [];
            const step = 10;
            
            for (let x = 0; x <= 600; x += step) {
                for (let y = 0; y <= 300; y += step) {
                    let votes = { A: 0, B: 0 };
                    
                    weakModels.forEach(model => {
                        const prediction = y > model.slope * x + model.intercept ? 'B' : 'A';
                        votes[prediction]++;
                    });
                    
                    const finalPrediction = votes.A > votes.B ? 'A' : 'B';
                    gridPoints.push({ x, y, prediction: finalPrediction });
                }
            }
            
            return gridPoints;
        }
        
        // Draw ensemble model
        function drawEnsembleModel() {
            // Clear previous boundaries except original data
            drawMainCanvas();
            
            // Draw ensemble decision regions
            if (ensembleModel) {
                const imageData = mainCtx.createImageData(mainCanvas.width, mainCanvas.height);
                const data = imageData.data;
                
                // Create background gradient based on predictions
                for (let x = 0; x < mainCanvas.width; x++) {
                    for (let y = 0; y < mainCanvas.height; y++) {
                        let votes = { A: 0, B: 0 };
                        
                        weakModels.forEach(model => {
                            const prediction = y > model.slope * x + model.intercept ? 'B' : 'A';
                            votes[prediction]++;
                        });
                        
                        const confidence = Math.abs(votes.A - votes.B) / weakModels.length;
                        const prediction = votes.A > votes.B ? 'A' : 'B';
                        
                        const pixelIndex = (y * mainCanvas.width + x) * 4;
                        
                        if (prediction === 'A') {
                            data[pixelIndex] = 139;     // R
                            data[pixelIndex + 1] = 92;  // G
                            data[pixelIndex + 2] = 246; // B
                            data[pixelIndex + 3] = confidence * 30; // A
                        } else {
                            data[pixelIndex] = 16;      // R
                            data[pixelIndex + 1] = 185; // G
                            data[pixelIndex + 2] = 129; // B
                            data[pixelIndex + 3] = confidence * 30; // A
                        }
                    }
                }
                
                mainCtx.putImageData(imageData, 0, 0);
            }
            
            // Redraw original data points on top
            originalData.forEach(point => {
                mainCtx.fillStyle = colors[`class${point.class}`];
                mainCtx.beginPath();
                mainCtx.arc(point.x, point.y, 4, 0, 2 * Math.PI);
                mainCtx.fill();
            });
        }
        
        // Draw decision boundary
        function drawDecisionBoundary(model, color, lineWidth) {
            mainCtx.strokeStyle = color;
            mainCtx.lineWidth = lineWidth;
            mainCtx.beginPath();
            
            const y1 = model.intercept;
            const y2 = model.slope * 600 + model.intercept;
            
            mainCtx.moveTo(0, Math.max(0, Math.min(mainCanvas.height, y1)));
            mainCtx.lineTo(600, Math.max(0, Math.min(mainCanvas.height, y2)));
            mainCtx.stroke();
        }
        
        // Draw main canvas
        function drawMainCanvas() {
            // Clear canvas
            mainCtx.fillStyle = colors.background;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);
            
            // Draw original data points
            originalData.forEach(point => {
                mainCtx.fillStyle = colors[`class${point.class}`];
                mainCtx.beginPath();
                mainCtx.arc(point.x, point.y, 4, 0, 2 * Math.PI);
                mainCtx.fill();
            });
        }
        
        // Update step indicator
        function updateStepIndicator() {
            const steps = ['step1', 'step2', 'step3', 'step4'];
            
            steps.forEach((stepId, index) => {
                const element = document.getElementById(stepId);
                element.classList.remove('active', 'completed');
                
                if (index + 1 < currentStep) {
                    element.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    element.classList.add('active');
                }
            });
        }
        
        // Update progress bar
        function updateProgress() {
            const progress = (currentStep - 1) / 3 * 100;
            progressFill.style.width = progress + '%';
        }
        
        // Update explanation text
        function updateExplanation() {
            const explanations = {
                1: "Ready to start! Generate new data to see two distinct classes. Then we'll create multiple bootstrap samples.",
                2: "Bootstrap samples created! Each sample contains randomly selected data points (with replacement). Notice some points appear multiple times while others are missing.",
                3: "Weak models trained! Each model creates a simple decision boundary on its bootstrap sample. These boundaries vary due to different training data.",
                4: "Ensemble complete! The final model aggregates all weak predictions through voting, creating a more robust and accurate classifier."
            };
            
            explanationText.innerHTML = `<p>${explanations[currentStep]}</p>`;
        }
        
        // Update button states
        function updateButtonStates() {
            createSamplesBtn.disabled = currentStep < 1;
            trainModelsBtn.disabled = currentStep < 2;
            aggregateBtn.disabled = currentStep < 3;
            
            // Update button text to show completion
            if (currentStep > 1) createSamplesBtn.innerHTML = '<i class="fas fa-check mr-2"></i>1. Create Samples (Bootstrap)';
            if (currentStep > 2) trainModelsBtn.innerHTML = '<i class="fas fa-check mr-2"></i>2. Train Weak Models';
            if (currentStep > 3) aggregateBtn.innerHTML = '<i class="fas fa-check mr-2"></i>3. Aggregate Models (Vote)';
        }
        
        // Toggle auto-run
        function toggleAutoRun() {
            if (isAutoRunning) {
                stopAutoRun();
            } else {
                startAutoRun();
            }
        }
        
        // Start auto-run
        function startAutoRun() {
            isAutoRunning = true;
            autoRunBtn.innerHTML = '<i class="fas fa-stop mr-2"></i>Stop Auto-Run';
            autoRunBtn.classList.remove('btn-secondary');
            autoRunBtn.classList.add('btn-primary');
            
            // Start the sequence
            generateData();
            
            let step = 1;
            autoRunInterval = setInterval(() => {
                switch (step) {
                    case 1:
                        createBootstrapSamples();
                        break;
                    case 2:
                        trainWeakModels();
                        break;
                    case 3:
                        aggregateModels();
                        break;
                    case 4:
                        // Reset and start over
                        setTimeout(() => {
                            generateData();
                            step = 0; // Will be incremented to 1
                        }, 2000);
                        break;
                }
                step++;
            }, 3000);
        }
        
        // Stop auto-run
        function stopAutoRun() {
            isAutoRunning = false;
            if (autoRunInterval) {
                clearInterval(autoRunInterval);
                autoRunInterval = null;
            }
            
            autoRunBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Auto-Run';
            autoRunBtn.classList.remove('btn-primary');
            autoRunBtn.classList.add('btn-secondary');
        }
        
        // Clear bootstrap grid
        function clearBootstrapGrid() {
            bootstrapGrid.innerHTML = '';
            bootstrapCanvases = [];
        }
        
        // Reset visualization
        function resetVisualization() {
            stopAutoRun();
            
            originalData = [];
            bootstrapSamples = [];
            weakModels = [];
            ensembleModel = null;
            currentStep = 0;
            
            // Clear canvases
            mainCtx.fillStyle = colors.background;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);
            clearBootstrapGrid();
            
            // Reset UI
            updateStepIndicator();
            updateProgress();
            updateButtonStates();
            updateSampleCount();
            
            // Reset button texts
            createSamplesBtn.innerHTML = '<i class="fas fa-random mr-2"></i>1. Create Samples (Bootstrap)';
            trainModelsBtn.innerHTML = '<i class="fas fa-brain mr-2"></i>2. Train Weak Models';
            aggregateBtn.innerHTML = '<i class="fas fa-vote-yea mr-2"></i>3. Aggregate Models (Vote)';
            
            explanationText.innerHTML = `
                <p>
                    <strong class="text-[#f3f4f6]">Bagging (Bootstrap Aggregating)</strong> creates multiple models on different subsets of data to improve prediction accuracy and reduce overfitting.
                </p>
                <div class="mt-3 space-y-2 text-xs">
                    <div><strong class="text-[#a78bfa]">Bootstrap Sampling:</strong> Create multiple datasets by sampling with replacement</div>
                    <div><strong class="text-[#a78bfa]">Weak Learners:</strong> Train simple models on each bootstrap sample</div>
                    <div><strong class="text-[#a78bfa]">Aggregation:</strong> Combine predictions through voting or averaging</div>
                    <div><strong class="text-[#a78bfa]">Result:</strong> A more robust and accurate ensemble model</div>
                </div>
            `;
            
            // Generate initial data
            generateData();
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
