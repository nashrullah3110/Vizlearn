<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZT6JM33V5J"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-ZT6JM33V5J');
        </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Context Length Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #101827;
            --panel-bg: #1f2937;
            --primary-accent: #8b5cf6;
            --lighter-accent-hover: #a78bfa;
            --primary-text: #f3f4f6;
            --secondary-text: #9ca3af;
            --border-color: #374151;
            --success-text: #a7f3d0;
            --forgotten-text-color: #fca5a5; /* light red */
            --loaded-text-color: #93c5fd;   /* light blue */
        }
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: var(--bg-color);
            color: var(--primary-text);
        }
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: var(--border-color);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #4b5563;
        }
        /* Custom Slider Styles */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
            width: 100%;
            cursor: pointer;
        }
        input[type=range]:focus {
            outline: none;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: var(--primary-accent);
            margin-top: -7px; /* Center thumb on track */
            transition: background-color 0.2s;
        }
        input[type=range]:hover::-webkit-slider-thumb {
            background: var(--lighter-accent-hover);
        }
        /* Token animation and coloring */
        .token {
            transition: color 0.5s ease-in-out, opacity 0.5s ease-in-out;
            padding: 1px 0;
        }
        .token.loaded {
            color: var(--loaded-text-color);
        }
        .token.forgotten {
            color: var(--forgotten-text-color);
            opacity: 0.75;
        }
        .footer-icon {
            transition: color 0.2s ease-in-out;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-[--bg-color] text-[--primary-text]">

    <!-- Header -->
    <header class="w-full p-4 bg-[--panel-bg] border-b border-[--border-color] text-center flex-shrink-0">
        <h1 class="text-2xl font-bold tracking-wider">LLM Context Length Explorer</h1>
    </header>

    <!-- Main Content -->
    <main class="flex-grow w-full max-w-screen-2xl mx-auto p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">

        <!-- Left Panel: Controls & Explanation -->
        <div class="lg:col-span-4 bg-[--panel-bg] border border-[--border-color] rounded-lg p-6 flex flex-col gap-6 shadow-lg">
            <!-- Controls Section -->
            <div>
                <label for="context-length-slider" class="block text-lg font-semibold mb-2 text-[--secondary-text]">Context Length</label>
                <div class="flex items-center gap-4">
                    <input type="range" id="context-length-slider" min="32" max="128" step="8" value="64" class="w-full">
                    <span id="context-length-value" class="font-bold text-xl text-[--primary-accent] w-12 text-center">64</span>
                </div>
                <p class="text-xs text-[--secondary-text] mt-1">Adjust the model's memory (in tokens).</p>
            </div>
            <div class="border-t border-[--border-color]"></div>
            <div>
                <h3 class="text-lg font-semibold mb-3 text-[--secondary-text]">Scenario Controls</h3>
                <button id="reset-btn" class="w-full py-2 px-4 bg-[--border-color] hover:bg-[#4b5563] text-white font-bold rounded-md transition-colors">Reset Scenario</button>
            </div>
            
            <!-- Explanation Section -->
            <div class="border-t border-[--border-color]"></div>
            <div class="flex-grow flex flex-col min-h-0">
                <h2 class="text-xl font-bold mb-3 flex-shrink-0">How It Works</h2>
                <div id="explanation-panel" class="flex-grow space-y-4 text-[--secondary-text] overflow-y-auto custom-scrollbar">
                    <!-- Dynamic explanations appear here -->
                </div>
            </div>
        </div>

        <!-- Right Panel: Visualization -->
        <div class="lg:col-span-8 bg-[--panel-bg] border border-[--border-color] rounded-lg p-4 flex flex-col shadow-lg">
            <div id="context-window" class="flex-grow border-2 border-dashed border-[--border-color] rounded-lg pt-10 p-3 overflow-hidden relative">
                <!-- UPDATED: Added a visual legend for the context colors -->
                <div class="absolute top-2 right-3 flex items-center gap-4">
                    <div class="flex items-center gap-1.5 text-xs">
                       <span class="h-2.5 w-2.5 rounded-full" style="background-color: var(--loaded-text-color);"></span>
                       <span class="text-[--secondary-text]">Inside Context</span>
                   </div>
                   <div class="flex items-center gap-1.5 text-xs">
                       <span class="h-2.5 w-2.5 rounded-full" style="background-color: var(--forgotten-text-color);"></span>
                       <span class="text-[--secondary-text]">Outside Context</span>
                   </div>
                </div>
                <div id="conversation-flow" class="h-full overflow-y-auto custom-scrollbar flex flex-col gap-2">
                    <!-- Messages appear here -->
                </div>
            </div>
            <div class="mt-4 flex gap-3">
                <input type="text" id="user-input" class="flex-grow bg-[--bg-color] border border-[--border-color] rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-[--primary-accent]" placeholder="Type your message...">
                <button id="send-btn" class="px-6 py-2 bg-[--primary-accent] hover:bg-[--lighter-accent-hover] text-white font-bold rounded-md transition-colors">Send</button>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="w-full p-6 bg-[--panel-bg] border-t border-[--border-color] flex-shrink-0">
        <div class="container mx-auto text-center text-[--secondary-text]">
            <div class="flex justify-center items-center space-x-6 mb-4">
                <a href="https://www.linkedin.com/in/ashish-jangra/" target="_blank" rel="noopener noreferrer" class="footer-icon text-[--secondary-text] hover:text-[--lighter-accent-hover]"><i class="fab fa-linkedin fa-2x"></i></a>
                <a href="https://github.com/AshishJangra27" target="_blank" rel="noopener noreferrer" class="footer-icon text-[--secondary-text] hover:text-[--lighter-accent-hover]"><i class="fab fa-github fa-2x"></i></a>
                <a href="https://www.kaggle.com/ashishjangra27" target="_blank" rel="noopener noreferrer" class="footer-icon text-[--secondary-text] hover:text-[--lighter-accent-hover]"><i class="fab fa-kaggle fa-2x"></i></a>
                <a href="https://huggingface.co/ashish-jangra" target="_blank" rel="noopener noreferrer" class="footer-icon text-[--secondary-text] hover:text-[--lighter-accent-hover]">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="inline-block">
                        <path d="M20.24,12.2a8.24,8.24,0,1,1-16.48,0a8.24,8.24,0,0,1,16.48,0Z"></path>
                        <path d="M15.42,16.2c.18-.42.24-.84.18-1.26a4.55,4.55,0,0,0-.54-1.5,4.55,4.55,0,0,0-1.5-.54c-.42-.06-.84.06-1.26.18a4.55,4.55,0,0,0-1.5.54,4.55,4.55,0,0,0-.54,1.5c-.06.42.06.84.18,1.26a4.55,4.55,0,0,0,.54,1.5,4.55,4.55,0,0,0,1.5.54c.42.06.84,0,1.26-.18a4.55,4.55,0,0,0,1.5-.54,4.55,4.55,0,0,0,.54-1.5Z" fill="var(--bg-color)"></path>
                        <path d="M10.26,10.26a1.44,1.44,0,1,1-2.88,0,1.44,1.44,0,0,1,2.88,0" fill="var(--bg-color)"></path>
                        <path d="M16.62,10.26a1.44,1.44,0,1,1-2.88,0,1.44,1.44,0,0,1,2.88,0" fill="var(--bg-color)"></path>
                    </svg>
                </a>
                <a href="https://www.instagram.com/ashish_zangra/" target="_blank" rel="noopener noreferrer" class="footer-icon text-[--secondary-text] hover:text-[--lighter-accent-hover]"><i class="fab fa-instagram fa-2x"></i></a>
            </div>
            <p class="text-sm">&copy; 2024 vizlearn. All Rights Reserved.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM Elements ---
    const contextLengthSlider = document.getElementById('context-length-slider');
    const contextLengthValue = document.getElementById('context-length-value');
    const resetBtn = document.getElementById('reset-btn');
    const conversationFlow = document.getElementById('conversation-flow');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const explanationPanel = document.getElementById('explanation-panel');

    // --- State Management ---
    let state = {
        contextLength: 64,
        conversation: [],
        totalTokens: 0,
        scenarioStep: 0,
        isScenarioRunning: false,
    };

    // --- Pre-defined Scenario ---
    const scenario = [
        {
            action: 'explain',
            // UPDATED: Removed color explanation from here as it's now in the UI
            text: "<strong>Welcome!</strong> This tool shows how an LLM's context length works. The scenario will begin automatically."
        },
        {
            action: 'add',
            author: 'model',
            text: "My favorite animal is the red panda."
        },
        {
            action: 'add',
            author: 'model',
            text: "The history of ancient Rome is a vast and complex topic, spanning over a thousand years from its mythical founding in 753 BC to the fall of the Western Roman Empire in 476 AD. This period saw the rise and fall of a civilization that left an indelible mark on Western culture, law, art, and language. Its innovations in engineering, architecture, and governance continue to influence the modern world."
        },
        {
            action: 'prompt',
            prompt: "What is my favorite animal?",
            explanation: "The model has been given two facts. Now, let's test its memory by asking it to recall the first fact. Click <strong>Send</strong>."
        },
        {
            action: 'evaluate',
            explanation: "Evaluating the model's response based on the active context..."
        },
        {
            action: 'explain',
            text: "The scenario is complete. The faded text was outside the context window and ignored by the model.<br><br>Try a <strong>larger context length</strong> and click 'Reset Scenario', or have your own conversation with the model."
        }
    ];

    // --- Core Functions ---

    function simpleTokenizer(text) {
        if (!text) return [];
        return text.trim().split(/\s+/);
    }

    function addMessage(author, text) {
        const tokens = simpleTokenizer(text);
        state.conversation.push({ author, text, tokens });
        state.totalTokens += tokens.length;
        render();
    }

    function handleModelResponse() {
        const contextStartIndex = Math.max(0, state.totalTokens - state.contextLength);
        let factFound = false;
        let tokenCounter = 0;

        for (const message of state.conversation) {
            for (const token of message.tokens) {
                if (tokenCounter >= contextStartIndex) {
                    if (message.text.toLowerCase().includes('red panda')) {
                        factFound = true;
                        break;
                    }
                }
                tokenCounter++;
            }
            if (factFound) break;
        }

        let modelReply, explanation;
        if (factFound) {
            modelReply = "My favorite animal is the red panda.";
            explanation = `<p class="text-[--success-text]"><strong>Success!</strong> The model correctly recalled the fact because it was in the loaded part of the context.</p>`;
        } else {
            modelReply = "I'm not sure what my favorite animal is.";
            explanation = `<p style='color: var(--forgotten-text-color)'><strong>Memory Failure!</strong> The model couldn't answer because the fact was in the forgotten part of the context.</p>`;
        }
        
        addMessage('model', modelReply);
        explanationPanel.innerHTML = explanation;
        
        if (state.isScenarioRunning) {
            state.scenarioStep++;
            setTimeout(updateScenario, 2000);
        }
    }

    // --- Rendering ---

    function render() {
        contextLengthValue.textContent = state.contextLength;
        contextLengthSlider.value = state.contextLength;

        conversationFlow.innerHTML = '';
        let tokenCounter = 0;
        const contextStartIndex = state.totalTokens - state.contextLength;

        state.conversation.forEach(message => {
            const messageDiv = document.createElement('div');
            const authorClass = message.author === 'user' ? 'bg-[--primary-accent]' : 'bg-[--border-color]';
            messageDiv.className = `p-3 rounded-lg max-w-[85%] w-fit break-words shadow ${authorClass} ${message.author === 'user' ? 'self-end' : 'self-start'}`;
            
            message.tokens.forEach(tokenText => {
                const tokenSpan = document.createElement('span');
                tokenSpan.textContent = tokenText + ' ';
                tokenSpan.className = 'token';

                if (tokenCounter < contextStartIndex) {
                    tokenSpan.classList.add('forgotten');
                } else {
                    tokenSpan.classList.add('loaded');
                }
                
                messageDiv.appendChild(tokenSpan);
                tokenCounter++;
            });
            
            conversationFlow.appendChild(messageDiv);
        });

        conversationFlow.scrollTop = conversationFlow.scrollHeight;
    }

    // --- Scenario Logic ---

    function updateScenario() {
        const currentStep = scenario[state.scenarioStep];
        if (!currentStep) {
            state.isScenarioRunning = false;
            return;
        }

        switch (currentStep.action) {
            case 'explain':
                explanationPanel.innerHTML = `<p>${currentStep.text}</p>`;
                break;
            case 'add':
                addMessage(currentStep.author, currentStep.text);
                state.scenarioStep++;
                setTimeout(updateScenario, 750);
                break;
            case 'prompt':
                explanationPanel.innerHTML = `<p>${currentStep.explanation}</p>`;
                userInput.value = currentStep.prompt;
                userInput.focus();
                break;
            case 'evaluate':
                explanationPanel.innerHTML = `<p>${currentStep.explanation}</p>`;
                setTimeout(handleModelResponse, 1000);
                break;
        }
    }

    function startScenario() {
        state.isScenarioRunning = true;
        state.scenarioStep = 1; // Skip initial explanation
        updateScenario();
    }

    function reset(fullReset = true, start = false) {
        if (fullReset) {
            state.contextLength = 64;
        }
        state.conversation = [];
        state.totalTokens = 0;
        state.scenarioStep = 0;
        state.isScenarioRunning = false;
        userInput.value = '';
        render();
        updateScenario(); // Show the initial welcome message

        if (start) {
            setTimeout(startScenario, 2500);
        }
    }

    // --- Event Listeners ---

    contextLengthSlider.addEventListener('input', (e) => {
        state.contextLength = parseInt(e.target.value, 10);
        render();
    });

    sendBtn.addEventListener('click', () => {
        const text = userInput.value.trim();
        if (!text) return;

        addMessage('user', text);
        userInput.value = '';

        if (state.isScenarioRunning && scenario[state.scenarioStep]?.action === 'prompt') {
            state.scenarioStep++;
            updateScenario();
        } else {
            handleModelResponse();
        }
    });

    userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            sendBtn.click();
        }
    });

    resetBtn.addEventListener('click', () => reset(true, true));

    // --- Initialization ---
    reset(true, true); // Initialize and start the scenario automatically
});
</script>

</body>
</html>
