<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Depth First Search Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-main: #101827;
            --bg-panel: #1f2937;
            --accent: #8b5cf6;
            --accent-light: #a78bfa;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --border: #374151;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background-color: var(--bg-main);
            color: var(--text-primary);
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node.unvisited {
            fill: var(--bg-panel);
            stroke: var(--border);
            stroke-width: 2;
        }

        .node.current {
            fill: var(--accent);
            stroke: var(--accent-light);
            stroke-width: 3;
            animation: pulse 1s infinite;
        }

        .node.visited {
            fill: var(--accent);
            stroke: var(--accent-light);
            stroke-width: 2;
            opacity: 0.7;
        }

        .node.in-stack {
            fill: var(--bg-panel);
            stroke: #fbbf24;
            stroke-width: 3;
            stroke-dasharray: 5,5;
            animation: dash 1s linear infinite;
        }

        .node.exploring {
            fill: #fbbf24;
            stroke: #f59e0b;
            stroke-width: 4;
            animation: exploring 1.2s infinite;
        }

        .node.backtracking {
            fill: #ef4444;
            stroke: #dc2626;
            stroke-width: 3;
            animation: backtrack 0.8s ease-in-out;
        }

        @keyframes exploring {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
        }

        @keyframes backtrack {
            0% { transform: scale(1.2); }
            50% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        .edge {
            stroke: var(--border);
            stroke-width: 2;
            transition: all 0.3s ease;
        }

        .edge.traversed {
            stroke: var(--accent);
            stroke-width: 3;
        }

        .edge.backtrack {
            stroke: #ef4444;
            stroke-width: 3;
            stroke-dasharray: 8,4;
            animation: dash 1s linear infinite;
        }

        .edge.exploring {
            stroke: #fbbf24;
            stroke-width: 4;
            animation: edgeGlow 0.8s ease-in-out;
        }

        .edge.path-highlight {
            stroke: #10b981;
            stroke-width: 4;
            animation: pathFlow 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        @keyframes dash {
            to { stroke-dashoffset: -10; }
        }

        @keyframes edgeGlow {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        @keyframes pathFlow {
            0% { stroke-dasharray: 10,10; stroke-dashoffset: 0; }
            100% { stroke-dashoffset: 20; }
        }

        .stack-item {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .stack-item.top {
            background: var(--accent);
            border-color: var(--accent-light);
        }

        .btn {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: var(--accent);
            border-color: var(--accent-light);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            background: var(--bg-panel);
            border-color: var(--border);
        }

        .slider {
            appearance: none;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            height: 6px;
            border-radius: 3px;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .pseudocode-line {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.3s ease;
        }

        .pseudocode-line.active {
            background: var(--accent);
            color: var(--text-primary);
            animation: highlight 0.5s ease-in-out;
        }

        @keyframes highlight {
            0% { background: var(--accent); transform: scale(1); }
            50% { background: var(--accent-light); transform: scale(1.02); }
            100% { background: var(--accent); transform: scale(1); }
        }

        .traversal-info {
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
        }

        .traversal-info.active {
            border-color: var(--accent);
            background: rgba(139, 92, 246, 0.1);
        }

        .path-trace {
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.5rem;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.875rem;
            max-height: 120px;
            overflow-y: auto;
        }

        .node-badge {
            display: inline-block;
            background: var(--accent);
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin: 0.125rem;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .node-badge.current {
            background: #fbbf24;
            color: #0f172a;
            animation: badgePulse 0.8s infinite;
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-[#101827] text-[#f3f4f6]">
    <!-- Header -->
    <header class="bg-[#1f2937] border-b border-[#374151] p-4">
        <h1 class="text-2xl font-bold text-center">Depth First Search Explorer</h1>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col lg:flex-row gap-4 p-4">
        <!-- Left Panel - Controls -->
        <div class="lg:w-1/4 bg-[#1f2937] border border-[#374151] rounded-lg p-4 space-y-6">
            <div>
                <h3 class="text-lg font-semibold mb-3">Graph Type</h3>
                <select id="graphType" class="w-full p-2 bg-[#101827] border border-[#374151] rounded text-[#f3f4f6]">
                    <option value="tree">Binary Tree</option>
                    <option value="grid">Grid Graph</option>
                    <option value="custom">Custom Graph</option>
                </select>
            </div>

            <div>
                <h3 class="text-lg font-semibold mb-3">Controls</h3>
                <div class="space-y-2">
                    <button id="startBtn" class="btn w-full p-2 rounded">Start DFS</button>
                    <button id="stepBtn" class="btn w-full p-2 rounded" disabled>Step Forward</button>
                    <button id="resetBtn" class="btn w-full p-2 rounded">Reset</button>
                    <button id="autoRunBtn" class="btn w-full p-2 rounded" disabled>Auto Run</button>
                </div>
            </div>

            <div>
                <h3 class="text-lg font-semibold mb-3">Speed</h3>
                <input type="range" id="speedSlider" class="slider w-full" min="1" max="10" value="5">
                <div class="flex justify-between text-sm text-[#9ca3af] mt-1">
                    <span>Slow</span>
                    <span>Fast</span>
                </div>
            </div>

            <div>
                <h3 class="text-lg font-semibold mb-3">Status</h3>
                <div class="bg-[#101827] border border-[#374151] rounded p-3 space-y-2">
                    <div class="flex justify-between">
                        <span class="text-[#9ca3af]">Current Node:</span>
                        <span id="currentNode">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-[#9ca3af]">Nodes Visited:</span>
                        <span id="nodesVisited">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-[#9ca3af]">Stack Size:</span>
                        <span id="stackSize">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-[#9ca3af]">Depth:</span>
                        <span id="currentDepth">0</span>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-lg font-semibold mb-3">Legend</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded-full bg-[#1f2937] border-2 border-[#374151]"></div>
                        <span>Unvisited</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded-full bg-[#8b5cf6]"></div>
                        <span>Current</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded-full bg-[#8b5cf6] opacity-70"></div>
                        <span>Visited</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded-full bg-[#1f2937] border-2 border-[#fbbf24] border-dashed"></div>
                        <span>In Stack</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded-full bg-[#fbbf24]"></div>
                        <span>Exploring</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 rounded-full bg-[#ef4444]"></div>
                        <span>Backtracking</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center Panel - Visualization -->
        <div class="lg:w-1/2 bg-[#1f2937] border border-[#374151] rounded-lg p-4">
            <div class="h-full flex flex-col">
                <h3 class="text-lg font-semibold mb-3">Graph Visualization</h3>
                <div class="flex-grow flex items-center justify-center">
                    <svg id="graphSvg" width="100%" height="100%" viewBox="0 0 600 400" class="border border-[#374151] rounded bg-[#101827]">
                        <!-- Graph will be rendered here -->
                    </svg>
                </div>
            </div>
        </div>

        <!-- Right Panel - Stack and Algorithm -->
        <div class="lg:w-1/4 space-y-6">
            <!-- DFS Stack -->
            <div class="bg-[#1f2937] border border-[#374151] rounded-lg p-4">
                <h3 class="text-lg font-semibold mb-3">DFS Stack (LIFO)</h3>
                <div id="stackContainer" class="space-y-1 min-h-[180px]">
                    <div class="text-[#9ca3af] text-center py-8">Stack is empty</div>
                </div>
                <div class="text-xs text-[#9ca3af] mt-2 text-center">
                    ↑ Top (Last In, First Out)
                </div>
            </div>

            <!-- Traversal Path -->
            <div class="bg-[#1f2937] border border-[#374151] rounded-lg p-4">
                <h3 class="text-lg font-semibold mb-3">Traversal Path</h3>
                <div id="traversalPath" class="path-trace">
                    <div class="text-[#9ca3af] text-center py-4">Path will appear here</div>
                </div>
            </div>

            <!-- Current Operation -->
            <div class="bg-[#1f2937] border border-[#374151] rounded-lg p-4">
                <h3 class="text-lg font-semibold mb-3">Current Operation</h3>
                <div id="currentOperation" class="traversal-info">
                    <div class="text-[#9ca3af] text-center">Ready to start</div>
                </div>
            </div>

            <!-- Algorithm Pseudocode -->
            <div class="bg-[#1f2937] border border-[#374151] rounded-lg p-4">
                <h3 class="text-lg font-semibold mb-3">Algorithm</h3>
                <div class="space-y-1 text-sm font-mono">
                    <div class="pseudocode-line" data-step="0">1. Push start node to stack</div>
                    <div class="pseudocode-line" data-step="1">2. While stack is not empty:</div>
                    <div class="pseudocode-line" data-step="2">&nbsp;&nbsp;a. Pop node from stack</div>
                    <div class="pseudocode-line" data-step="3">&nbsp;&nbsp;b. Mark as visited</div>
                    <div class="pseudocode-line" data-step="4">&nbsp;&nbsp;c. For each neighbor:</div>
                    <div class="pseudocode-line" data-step="5">&nbsp;&nbsp;&nbsp;&nbsp;- If not visited</div>
                    <div class="pseudocode-line" data-step="6">&nbsp;&nbsp;&nbsp;&nbsp;- Push to stack</div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="bg-[#1f2937] border border-[#374151] rounded-lg p-4">
                <h3 class="text-lg font-semibold mb-3">Complexity</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-[#9ca3af]">Time:</span>
                        <span>O(V + E)</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-[#9ca3af]">Space:</span>
                        <span>O(V)</span>
                    </div>
                    <div class="text-[#9ca3af] text-xs mt-2">
                        V = vertices, E = edges
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-[#1f2937] border-t border-[#374151] p-4 mt-auto">
        <div class="flex justify-center space-x-6">
            <a href="https://www.linkedin.com/in/ashish-jangra/" class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors">
                <i class="fab fa-linkedin fa-2x"></i>
            </a>
            <a href="https://github.com/AshishJangra27" class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors">
                <i class="fab fa-github fa-2x"></i>
            </a>
            <a href="https://www.kaggle.com/ashishjangra27" class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors">
                <i class="fab fa-kaggle fa-2x"></i>
            </a>
            <a href="https://huggingface.co/ashish-jangra" class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                </svg>
            </a>
            <a href="https://www.instagram.com/ashish_zangra/" class="text-[#9ca3af] hover:text-[#a78bfa] transition-colors">
                <i class="fab fa-instagram fa-2x"></i>
            </a>
        </div>
    </footer>

    <script>
        class DFSVisualizer {
            constructor() {
                this.svg = document.getElementById('graphSvg');
                this.graphType = 'tree';
                this.nodes = [];
                this.edges = [];
                this.visited = new Set();
                this.stack = [];
                this.currentNode = null;
                this.isRunning = false;
                this.autoRunning = false;
                this.step = 0;
                this.speed = 500;
                this.adjacencyList = {};
                this.traversalOrder = [];
                this.isBacktracking = false;
                this.previousNode = null;
                this.currentOperation = '';
                
                this.initializeGraph();
                this.setupEventListeners();
                this.updateUI();
            }

            setupEventListeners() {
                document.getElementById('graphType').addEventListener('change', (e) => {
                    this.graphType = e.target.value;
                    this.resetVisualization();
                    this.initializeGraph();
                });

                document.getElementById('startBtn').addEventListener('click', () => this.startDFS());
                document.getElementById('stepBtn').addEventListener('click', () => this.stepForward());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetVisualization());
                document.getElementById('autoRunBtn').addEventListener('click', () => this.toggleAutoRun());
                document.getElementById('speedSlider').addEventListener('input', (e) => {
                    this.speed = 1100 - parseInt(e.target.value) * 100;
                });
            }

            initializeGraph() {
                this.svg.innerHTML = '';
                this.nodes = [];
                this.edges = [];
                this.adjacencyList = {};

                if (this.graphType === 'tree') {
                    this.createBinaryTree();
                } else if (this.graphType === 'grid') {
                    this.createGridGraph();
                } else {
                    this.createCustomGraph();
                }

                this.renderGraph();
            }

            createBinaryTree() {
                // Create a sample binary tree
                const positions = [
                    {id: 'A', x: 300, y: 50},
                    {id: 'B', x: 200, y: 120},
                    {id: 'C', x: 400, y: 120},
                    {id: 'D', x: 150, y: 190},
                    {id: 'E', x: 250, y: 190},
                    {id: 'F', x: 350, y: 190},
                    {id: 'G', x: 450, y: 190},
                    {id: 'H', x: 125, y: 260},
                    {id: 'I', x: 175, y: 260}
                ];

                this.nodes = positions;
                this.edges = [
                    {from: 'A', to: 'B'},
                    {from: 'A', to: 'C'},
                    {from: 'B', to: 'D'},
                    {from: 'B', to: 'E'},
                    {from: 'C', to: 'F'},
                    {from: 'C', to: 'G'},
                    {from: 'D', to: 'H'},
                    {from: 'D', to: 'I'}
                ];

                this.buildAdjacencyList();
            }

            createGridGraph() {
                // Create a 4x3 grid
                const rows = 3, cols = 4;
                const startX = 100, startY = 80;
                const spacing = 120;

                for (let i = 0; i < rows; i++) {
                    for (let j = 0; j < cols; j++) {
                        const id = `${i},${j}`;
                        this.nodes.push({
                            id: id,
                            x: startX + j * spacing,
                            y: startY + i * spacing
                        });
                    }
                }

                // Add edges (4-connectivity)
                for (let i = 0; i < rows; i++) {
                    for (let j = 0; j < cols; j++) {
                        const current = `${i},${j}`;
                        if (j < cols - 1) this.edges.push({from: current, to: `${i},${j+1}`});
                        if (i < rows - 1) this.edges.push({from: current, to: `${i+1},${j}`});
                    }
                }

                this.buildAdjacencyList();
            }

            createCustomGraph() {
                // Create a more complex graph
                this.nodes = [
                    {id: 'A', x: 150, y: 100},
                    {id: 'B', x: 300, y: 80},
                    {id: 'C', x: 450, y: 120},
                    {id: 'D', x: 100, y: 200},
                    {id: 'E', x: 250, y: 180},
                    {id: 'F', x: 400, y: 220},
                    {id: 'G', x: 200, y: 280},
                    {id: 'H', x: 350, y: 300}
                ];

                this.edges = [
                    {from: 'A', to: 'B'},
                    {from: 'A', to: 'D'},
                    {from: 'B', to: 'C'},
                    {from: 'B', to: 'E'},
                    {from: 'C', to: 'F'},
                    {from: 'D', to: 'E'},
                    {from: 'D', to: 'G'},
                    {from: 'E', to: 'F'},
                    {from: 'E', to: 'G'},
                    {from: 'F', to: 'H'},
                    {from: 'G', to: 'H'}
                ];

                this.buildAdjacencyList();
            }

            buildAdjacencyList() {
                this.adjacencyList = {};
                this.nodes.forEach(node => {
                    this.adjacencyList[node.id] = [];
                });

                this.edges.forEach(edge => {
                    this.adjacencyList[edge.from].push(edge.to);
                    this.adjacencyList[edge.to].push(edge.from);
                });
            }

            renderGraph() {
                // Render edges first
                this.edges.forEach(edge => {
                    const fromNode = this.nodes.find(n => n.id === edge.from);
                    const toNode = this.nodes.find(n => n.id === edge.to);
                    
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', fromNode.x);
                    line.setAttribute('y1', fromNode.y);
                    line.setAttribute('x2', toNode.x);
                    line.setAttribute('y2', toNode.y);
                    line.setAttribute('class', 'edge');
                    line.setAttribute('id', `edge-${edge.from}-${edge.to}`);
                    this.svg.appendChild(line);
                });

                // Render nodes
                this.nodes.forEach(node => {
                    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    g.setAttribute('id', `node-${node.id}`);
                    g.setAttribute('class', 'node unvisited');
                    g.style.cursor = 'pointer';

                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', node.x);
                    circle.setAttribute('cy', node.y);
                    circle.setAttribute('r', 20);
                    
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', node.x);
                    text.setAttribute('y', node.y + 5);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('fill', '#f3f4f6');
                    text.setAttribute('font-family', 'Roboto Mono');
                    text.setAttribute('font-size', '14');
                    text.textContent = node.id;

                    g.appendChild(circle);
                    g.appendChild(text);
                    this.svg.appendChild(g);

                    // Add click event for setting start node
                    g.addEventListener('click', () => {
                        if (!this.isRunning) {
                            this.setStartNode(node.id);
                        }
                    });
                });
            }

            setStartNode(nodeId) {
                // Remove previous start node styling
                this.nodes.forEach(node => {
                    const element = document.getElementById(`node-${node.id}`);
                    element.classList.remove('current');
                    element.classList.add('unvisited');
                });

                // Set new start node
                const element = document.getElementById(`node-${nodeId}`);
                element.classList.remove('unvisited');
                element.classList.add('current');
                
                this.currentNode = nodeId;
                this.updateUI();
            }

            startDFS() {
                if (!this.currentNode) {
                    this.setStartNode(this.nodes[0].id);
                }

                this.isRunning = true;
                this.visited.clear();
                this.stack = [this.currentNode];
                this.step = 0;
                this.traversalOrder = [];
                this.isBacktracking = false;
                this.previousNode = null;

                // Update UI
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stepBtn').disabled = false;
                document.getElementById('autoRunBtn').disabled = false;

                this.updateCurrentOperation(`Starting DFS from node ${this.currentNode}`);
                this.updateStack();
                this.updateTraversalPath();
                this.highlightPseudocode(0);
                this.updateUI();
            }

            stepForward() {
                if (this.stack.length === 0) {
                    this.finishDFS();
                    return;
                }

                const current = this.stack.pop();
                this.previousNode = this.currentNode;
                this.currentNode = current;

                // Show exploring animation
                this.updateCurrentOperation(`Visiting node ${current}`);
                const currentElement = document.getElementById(`node-${current}`);
                currentElement.classList.remove('current', 'in-stack', 'backtracking');
                currentElement.classList.add('exploring');

                // Add to traversal order
                if (!this.visited.has(current)) {
                    this.traversalOrder.push(current);
                    this.visited.add(current);
                }

                // Show edge being explored
                if (this.previousNode && this.previousNode !== current) {
                    this.highlightEdgeExploration(this.previousNode, current);
                }

                setTimeout(() => {
                    // Mark as visited after exploration
                    currentElement.classList.remove('exploring');
                    currentElement.classList.add('visited');

                    // Check if we're backtracking
                    const neighbors = this.adjacencyList[current] || [];
                    const unvisitedNeighbors = neighbors.filter(neighbor => 
                        !this.visited.has(neighbor) && !this.stack.includes(neighbor)
                    );

                    if (unvisitedNeighbors.length === 0 && this.stack.length > 0) {
                        this.isBacktracking = true;
                        this.updateCurrentOperation(`Backtracking from ${current} (no unvisited neighbors)`);
                        this.showBacktrackAnimation(current);
                    } else {
                        this.isBacktracking = false;
                        this.updateCurrentOperation(`Exploring neighbors of ${current}`);
                    }

                    // Add unvisited neighbors to stack
                    unvisitedNeighbors.forEach(neighbor => {
                        this.stack.push(neighbor);
                        
                        // Mark as in stack
                        const neighborElement = document.getElementById(`node-${neighbor}`);
                        neighborElement.classList.remove('unvisited');
                        neighborElement.classList.add('in-stack');

                        // Highlight edge to neighbor
                        this.highlightEdgeToNeighbor(current, neighbor);
                    });

                    // Update traversed edges
                    neighbors.forEach(neighbor => {
                        if (this.visited.has(neighbor)) {
                            const edge1 = document.getElementById(`edge-${current}-${neighbor}`);
                            const edge2 = document.getElementById(`edge-${neighbor}-${current}`);
                            if (edge1) edge1.classList.add('traversed');
                            if (edge2) edge2.classList.add('traversed');
                        }
                    });

                    this.updateStack();
                    this.updateTraversalPath();
                    this.updateUI();
                    this.cyclePseudocode();
                }, 800);
            }

            toggleAutoRun() {
                if (this.autoRunning) {
                    this.stopAutoRun();
                } else {
                    this.startAutoRun();
                }
            }

            startAutoRun() {
                this.autoRunning = true;
                document.getElementById('autoRunBtn').textContent = 'Stop Auto';
                document.getElementById('stepBtn').disabled = true;

                this.autoRunInterval = setInterval(() => {
                    if (this.stack.length === 0) {
                        this.stopAutoRun();
                        this.finishDFS();
                        return;
                    }
                    this.stepForward();
                }, this.speed + 400); // Slower for better visualization
            }

            stopAutoRun() {
                this.autoRunning = false;
                document.getElementById('autoRunBtn').textContent = 'Auto Run';
                document.getElementById('stepBtn').disabled = false;
                if (this.autoRunInterval) {
                    clearInterval(this.autoRunInterval);
                }
            }

            finishDFS() {
                this.isRunning = false;
                this.stopAutoRun();
                document.getElementById('stepBtn').disabled = true;
                document.getElementById('autoRunBtn').disabled = true;
                this.updateCurrentOperation(`DFS Complete! Visited ${this.visited.size} nodes in order: ${this.traversalOrder.join(' → ')}`);
                this.clearPseudocodeHighlight();
            }

            resetVisualization() {
                this.isRunning = false;
                this.autoRunning = false;
                this.visited.clear();
                this.stack = [];
                this.currentNode = null;
                this.step = 0;
                this.traversalOrder = [];
                this.isBacktracking = false;
                this.previousNode = null;

                if (this.autoRunInterval) {
                    clearInterval(this.autoRunInterval);
                }

                // Reset UI
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stepBtn').disabled = true;
                document.getElementById('autoRunBtn').disabled = true;
                document.getElementById('autoRunBtn').textContent = 'Auto Run';

                // Reset visual elements
                this.nodes.forEach(node => {
                    const element = document.getElementById(`node-${node.id}`);
                    element.className = 'node unvisited';
                });

                this.edges.forEach(edge => {
                    const edge1 = document.getElementById(`edge-${edge.from}-${edge.to}`);
                    const edge2 = document.getElementById(`edge-${edge.to}-${edge.from}`);
                    if (edge1) edge1.className = 'edge';
                    if (edge2) edge2.className = 'edge';
                });

                this.updateStack();
                this.updateTraversalPath();
                this.updateCurrentOperation('Ready to start');
                this.updateUI();
                this.clearPseudocodeHighlight();
            }

            updateStack() {
                const container = document.getElementById('stackContainer');
                
                if (this.stack.length === 0) {
                    container.innerHTML = '<div class="text-[#9ca3af] text-center py-8">Stack is empty</div>';
                    return;
                }

                container.innerHTML = '';
                
                // Display stack from top to bottom (reverse order)
                for (let i = this.stack.length - 1; i >= 0; i--) {
                    const item = document.createElement('div');
                    item.className = `stack-item p-2 rounded text-center ${i === this.stack.length - 1 ? 'top' : ''}`;
                    item.innerHTML = `
                        <div class="font-bold">${this.stack[i]}</div>
                        ${i === this.stack.length - 1 ? '<div class="text-xs text-[#9ca3af]">← Next to pop</div>' : ''}
                    `;
                    container.appendChild(item);
                }
            }

            updateTraversalPath() {
                const container = document.getElementById('traversalPath');
                
                if (this.traversalOrder.length === 0) {
                    container.innerHTML = '<div class="text-[#9ca3af] text-center py-4">Path will appear here</div>';
                    return;
                }

                const pathHtml = this.traversalOrder.map((node, index) => {
                    const isLast = index === this.traversalOrder.length - 1;
                    return `<span class="node-badge ${isLast ? 'current' : ''}">${node}</span>`;
                }).join('');

                container.innerHTML = `
                    <div class="text-xs text-[#9ca3af] mb-2">Traversal Order:</div>
                    <div>${pathHtml}</div>
                `;
            }

            updateCurrentOperation(operation) {
                const container = document.getElementById('currentOperation');
                container.innerHTML = `
                    <div class="font-medium text-sm">${operation}</div>
                    ${this.isBacktracking ? 
                        '<div class="text-xs text-[#ef4444] mt-1">🔄 Backtracking in progress</div>' : 
                        '<div class="text-xs text-[#10b981] mt-1">🔍 Exploring forward</div>'
                    }
                `;
                container.classList.add('active');
                
                setTimeout(() => {
                    container.classList.remove('active');
                }, 1000);
            }

            highlightEdgeExploration(from, to) {
                const edge1 = document.getElementById(`edge-${from}-${to}`);
                const edge2 = document.getElementById(`edge-${to}-${from}`);
                
                [edge1, edge2].forEach(edge => {
                    if (edge) {
                        edge.classList.add('exploring');
                        setTimeout(() => {
                            edge.classList.remove('exploring');
                        }, 1000);
                    }
                });
            }

            highlightEdgeToNeighbor(from, to) {
                const edge1 = document.getElementById(`edge-${from}-${to}`);
                const edge2 = document.getElementById(`edge-${to}-${from}`);
                
                [edge1, edge2].forEach(edge => {
                    if (edge) {
                        edge.classList.add('path-highlight');
                        setTimeout(() => {
                            edge.classList.remove('path-highlight');
                        }, 1500);
                    }
                });
            }

            showBacktrackAnimation(node) {
                const element = document.getElementById(`node-${node}`);
                element.classList.add('backtracking');
                
                setTimeout(() => {
                    element.classList.remove('backtracking');
                }, 800);
            }

            updateUI() {
                document.getElementById('currentNode').textContent = this.currentNode || '-';
                document.getElementById('nodesVisited').textContent = this.visited.size;
                document.getElementById('stackSize').textContent = this.stack.length;
                document.getElementById('currentDepth').textContent = this.stack.length;
            }

            highlightPseudocode(step) {
                document.querySelectorAll('.pseudocode-line').forEach(line => {
                    line.classList.remove('active');
                });
                
                const line = document.querySelector(`[data-step="${step}"]`);
                if (line) {
                    line.classList.add('active');
                }
            }

            cyclePseudocode() {
                this.step = (this.step + 1) % 7;
                this.highlightPseudocode(this.step);
            }

            clearPseudocodeHighlight() {
                document.querySelectorAll('.pseudocode-line').forEach(line => {
                    line.classList.remove('active');
                });
            }
        }

        // Initialize the visualizer when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new DFSVisualizer();
        });
    </script>
</body>
</html>
