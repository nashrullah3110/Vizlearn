<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bias-Variance Tradeoff Explorer</title>
    
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        // Tailwind CSS Configuration
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'main-background': '#101827',
                        'panel-backgrounds': '#1f2937',
                        'primary-accent': '#8b5cf6',
                        'lighter-accent-hover': '#a78bfa',
                        'primary-text': '#f3f4f6',
                        'secondary-text': '#9ca3af',
                        'borders': '#374151',
                    },
                    fontFamily: {
                        mono: ['Roboto Mono', 'monospace'],
                    },
                    fontSize: {
                        '1.6vh': '1.6vh',
                        '1.7vh': '1.7vh',
                        '1.8vh': '1.8vh',
                        '2vh': '2vh',
                        '2.2vh': '2.2vh',
                        '2.5vh': '2.5vh',
                        '3vh': '3vh',
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Base layout and non-scrollable setup */
        html {
            height: 100%;
        }
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* Crucial for non-scrollable */
            display: grid;
            grid-template-rows: 8vh 84vh 8vh;
            grid-template-columns: 100vw;
            font-family: 'Roboto Mono', monospace;
            color: #f3f4f6; /* primary-text */
            background-color: #101827; /* main-background */
        }

        header, footer {
            grid-column: 1 / 2;
        }

        main {
            grid-area: 2 / 1 / 3 / 2;
            display: grid;
            grid-template-columns: 20vw 60vw 20vw;
            grid-template-rows: 100%;
            overflow: hidden;
        }

        .left-panel, .center-panel, .right-panel {
            overflow-y: auto;
        }

        /* Custom Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]:focus {
            outline: none;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #374151; /* borders */
            border-radius: 3px;
        }
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #374151;
            border-radius: 3px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            border: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #8b5cf6; /* primary-accent */
            cursor: pointer;
            margin-top: -7px;
            transition: background 0.2s ease-in-out;
        }
        input[type=range]::-moz-range-thumb {
            border: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #8b5cf6;
            cursor: pointer;
        }
        input[type=range]:hover::-webkit-slider-thumb {
            background: #a78bfa; /* lighter-accent-hover */
        }
        input[type=range]:hover::-moz-range-thumb {
            background: #a78bfa;
        }
    </style>
</head>
<body class="bg-main-background font-mono text-primary-text">

    <!-- HEADER -->
    <header class="flex items-center justify-center border-b border-borders bg-panel-backgrounds">
        <h1 class="text-2.5vh font-bold tracking-wider">BIAS-VARIANCE TRADEOFF EXPLORER</h1>
    </header>

    <!-- MAIN CONTENT -->
    <main>
        <!-- LEFT PANEL: CONTROLS -->
        <div class="left-panel p-[2vw] border-r border-borders bg-panel-backgrounds flex flex-col">
            <h2 class="text-2.2vh font-bold mb-[3vh]">CONTROLS</h2>
            
            <div class="control-group">
                <label for="complexitySlider" class="block text-1.8vh text-secondary-text mb-[1vh]">MODEL COMPLEXITY</label>
                <input type="range" id="complexitySlider" min="1" max="15" value="3" class="w-full">
                <span id="complexityValue" class="text-secondary-text text-center block mt-1">Degree: 3</span>
            </div>

            <div class="control-group mt-[4vh]">
                <label for="noiseSlider" class="block text-1.8vh text-secondary-text mb-[1vh]">DATA NOISE LEVEL</label>
                <input type="range" id="noiseSlider" min="0" max="1" step="0.05" value="0.2" class="w-full">
                <span id="noiseValue" class="text-secondary-text text-center block mt-1">Noise: 0.20</span>
            </div>

            <button id="newDataBtn" class="w-full text-2vh py-[1.5vh] px-[2.5vh] mt-[5vh] border-none rounded-md cursor-pointer bg-primary-accent text-primary-text font-bold hover:bg-lighter-accent-hover transition-colors">
                GENERATE NEW DATA
            </button>

            <button id="resetBtn" class="w-full text-2vh py-[1.5vh] px-[2.5vh] mt-[3vh] rounded-md cursor-pointer bg-transparent border border-secondary-text text-secondary-text font-bold hover:bg-secondary-text hover:text-panel-backgrounds transition-colors">
                RESET ALL
            </button>
        </div>

        <!-- CENTER PANEL: VISUALIZATION -->
        <div class="center-panel p-[2vw] flex flex-col items-center justify-center bg-main-background">
            <h2 class="text-2.2vh font-bold mb-[2vh] text-primary-text">DATA & MODEL FIT</h2>
            <canvas id="visualizationCanvas" class="bg-panel-backgrounds rounded-md"></canvas>
            <p id="stateIndicator" class="text-2.5vh font-bold text-center mt-[2vh] transition-colors duration-300">
                CURRENT STATE: HIGH BIAS (UNDERFITTING)
            </p>
        </div>

        <!-- RIGHT PANEL: EXPLANATION & METRICS -->
        <div class="right-panel p-[2vw] border-l border-borders bg-panel-backgrounds">
            <h2 class="text-2.2vh font-bold mb-[3vh]">UNDERSTANDING</h2>
            
            <div class="definitions">
                <h3 class="text-primary-accent font-bold">BIAS:</h3>
                <p class="text-1.6vh text-secondary-text mb-[3vh]">
                    A model's tendency to consistently miss the true relationship. High bias means the model is too simple and underfits the data.
                </p>
                <h3 class="text-primary-accent font-bold">VARIANCE:</h3>
                <p class="text-1.6vh text-secondary-text mb-[3vh]">
                    A model's sensitivity to small fluctuations in the training data. High variance means the model is too complex and overfits the noise.
                </p>
            </div>

            <h2 class="text-2.2vh font-bold mt-[4vh] mb-[2vh]">MODEL METRICS</h2>
            <div id="metricsContainer" class="space-y-4 bg-main-background p-4 rounded-md border border-borders">
                <div class="metric-item">
                    <p class="text-primary-accent font-bold">BIASÂ²:</p>
                    <p id="biasValue" class="text-2vh text-primary-text font-mono">Calculating...</p>
                </div>
                <div class="metric-item mt-3">
                    <p class="text-primary-accent font-bold">VARIANCE:</p>
                    <p id="varianceValue" class="text-2vh text-primary-text font-mono">Calculating...</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer w-full py-8 bg-panel-backgrounds border-t border-borders">
        <div class="container mx-auto px-6 text-center text-gray-400">
            <div class="flex justify-center items-center space-x-6 mb-4">
                <a href="https://www.linkedin.com/in/ashish-jangra/" target="_blank" rel="noopener noreferrer" class="footer-icon">
                    <i class="fab fa-linkedin fa-2x"></i>
                </a>
                <a href="https://github.com/AshishJangra27" target="_blank" rel="noopener noreferrer" class="footer-icon">
                    <i class="fab fa-github fa-2x"></i>
                </a>
                 <a href="https://www.kaggle.com/ashishjangra27" target="_blank" rel="noopener noreferrer" class="footer-icon">
                    <i class="fab fa-kaggle fa-2x"></i>
                </a>
                <a href="https://huggingface.co/ashish-jangra" target="_blank" rel="noopener noreferrer" class="footer-icon">
                     <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block">
                        <path d="M20.24,12.2a8.24,8.24,0,1,1-16.48,0a8.24,8.24,0,0,1,16.48,0Z" fill="currentColor"></path>
                        <path d="M15.42,16.2c.18-.42.24-.84.18-1.26a4.55,4.55,0,0,0-.54-1.5,4.55,4.55,0,0,0-1.5-.54c-.42-.06-.84.06-1.26.18a4.55,4.55,0,0,0-1.5.54,4.55,4.55,0,0,0-.54,1.5c-.06.42.06.84.18,1.26a4.55,4.55,0,0,0,.54,1.5,4.55,4.55,0,0,0,1.5.54c.42.06.84,0,1.26-.18a4.55,4.55,0,0,0,1.5-.54,4.55,4.55,0,0,0,.54-1.5Z" fill="#101827"></path>
                        <path d="M10.26,10.26a1.44,1.44,0,1,1-2.88,0,1.44,1.44,0,0,1,2.88,0" fill="#101827"></path>
                        <path d="M16.62,10.26a1.44,1.44,0,1,1-2.88,0,1.44,1.44,0,0,1,2.88,0" fill="#101827"></path>
                    </svg>
                </a>
                 <a href="https://www.instagram.com/ashish_zangra/" target="_blank" rel="noopener noreferrer" class="footer-icon">
                    <i class="fab fa-instagram fa-2x"></i>
                </a>
            </div>
            <p>&copy; 2024 vizlearn. All Rights Reserved.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DOM ELEMENT REFERENCES ---
    const complexitySlider = document.getElementById('complexitySlider');
    const complexityValueSpan = document.getElementById('complexityValue');
    const noiseSlider = document.getElementById('noiseSlider');
    const noiseValueSpan = document.getElementById('noiseValue');
    const newDataBtn = document.getElementById('newDataBtn');
    const resetBtn = document.getElementById('resetBtn');
    const canvas = document.getElementById('visualizationCanvas');
    const ctx = canvas.getContext('2d');
    const stateIndicator = document.getElementById('stateIndicator');
    const biasValue = document.getElementById('biasValue');
    const varianceValue = document.getElementById('varianceValue');

    // --- STATE VARIABLES ---
    let modelComplexity = 3;
    let noiseLevel = 0.2;
    let dataPoints = [];
    let modelCoefficients = [];

    // --- CONSTANTS & CONFIG ---
    const NUM_DATA_POINTS = 50;
    const TRUE_FN_COLOR = '#374151';
    const DATA_POINT_COLOR = '#9ca3af';
    const MODEL_CURVE_COLOR = '#8b5cf6';
    const OPTIMAL_COLOR = '#8b5cf6';
    const SUBOPTIMAL_COLOR = '#f3f4f6';
    const CANVAS_PADDING = 40;
    const TRUE_FUNCTION = (x) => 0.5 * Math.sin(x * 2.5 * Math.PI);

    // --- MATRIX MATH HELPERS ---
    function solveLinearSystem(A, b) {
        const n = A.length;
        const Ab = A.map((row, i) => [...row, b[i]]);
        for (let i = 0; i < n; i++) {
            let maxRow = i;
            for (let k = i + 1; k < n; k++) {
                if (Math.abs(Ab[k][i]) > Math.abs(Ab[maxRow][i])) {
                    maxRow = k;
                }
            }
            [Ab[i], Ab[maxRow]] = [Ab[maxRow], Ab[i]];
            if (Math.abs(Ab[i][i]) < 1e-10) continue; // Skip if pivot is zero
            for (let k = i + 1; k < n; k++) {
                const c = -Ab[k][i] / Ab[i][i];
                for (let j = i; j < n + 1; j++) {
                    if (i === j) Ab[k][j] = 0;
                    else Ab[k][j] += c * Ab[i][j];
                }
            }
        }
        const x = new Array(n).fill(0);
        for (let i = n - 1; i > -1; i--) {
            if (Math.abs(Ab[i][i]) < 1e-10) continue; // Avoid division by zero
            x[i] = Ab[i][n] / Ab[i][i];
            for (let k = i - 1; k > -1; k--) {
                Ab[k][n] -= Ab[k][i] * x[i];
            }
        }
        return x;
    }

    // --- CORE APPLICATION LOGIC ---

    // 1. Generate Data Points for the main visualization
    function generateData() {
        dataPoints = [];
        for (let i = 0; i < NUM_DATA_POINTS; i++) {
            const x = Math.random();
            const noise = (Math.random() - 0.5) * noiseLevel * 2;
            const y = TRUE_FUNCTION(x) + noise;
            dataPoints.push({ x, y });
        }
    }

    // 2. Fit a polynomial model to the main data
    function fitModel() {
        const degree = modelComplexity;
        const n = dataPoints.length;
        if (n === 0) {
            modelCoefficients = [];
            return;
        }

        const X = dataPoints.map(p => Array.from({length: degree + 1}, (_, j) => Math.pow(p.x, j)));
        const y = dataPoints.map(p => p.y);

        // More robust matrix calculation using loops
        const XtX = Array.from({ length: degree + 1 }, () => Array(degree + 1).fill(0));
        const XtY = Array(degree + 1).fill(0);

        for (let i = 0; i < n; i++) {
            const x_row = X[i];
            const y_val = y[i];
            for (let j = 0; j <= degree; j++) {
                for (let k = 0; k <= degree; k++) {
                    XtX[j][k] += x_row[j] * x_row[k];
                }
                XtY[j] += x_row[j] * y_val;
            }
        }
        modelCoefficients = solveLinearSystem(XtX, XtY);
    }
    
    // 3. Calculate Bias and Variance via Simulation
    async function calculateBiasVariance() {
        const NUM_SIMULATIONS = 30;
        const NUM_TEST_POINTS = 100;
        const testPointsX = Array.from({ length: NUM_TEST_POINTS }, (_, i) => i / (NUM_TEST_POINTS - 1));
        const trueValuesY = testPointsX.map(x => TRUE_FUNCTION(x));

        let predictions = Array.from({ length: NUM_TEST_POINTS }, () => []);

        for (let s = 0; s < NUM_SIMULATIONS; s++) {
            const simData = [];
            for (let i = 0; i < NUM_DATA_POINTS; i++) {
                const x = Math.random();
                const noise = (Math.random() - 0.5) * noiseLevel * 2;
                simData.push({ x, y: TRUE_FUNCTION(x) + noise });
            }
            
            const degree = modelComplexity;
            const n_sim = simData.length;
            if (n_sim === 0) continue;

            const X_sim = simData.map(p => Array.from({length: degree + 1}, (_, j) => Math.pow(p.x, j)));
            const y_sim = simData.map(p => p.y);

            const XtX_sim = Array.from({ length: degree + 1 }, () => Array(degree + 1).fill(0));
            const XtY_sim = Array(degree + 1).fill(0);

            for (let i = 0; i < n_sim; i++) {
                const x_row = X_sim[i];
                const y_val = y_sim[i];
                for (let j = 0; j <= degree; j++) {
                    for (let k = 0; k <= degree; k++) {
                        XtX_sim[j][k] += x_row[j] * x_row[k];
                    }
                    XtY_sim[j] += x_row[j] * y_val;
                }
            }

            const simCoefficients = solveLinearSystem(XtX_sim, XtY_sim);

            if (simCoefficients && simCoefficients.length > 0) {
                for (let i = 0; i < NUM_TEST_POINTS; i++) {
                    const x = testPointsX[i];
                    let y_hat = simCoefficients.reduce((sum, coeff, j) => sum + coeff * Math.pow(x, j), 0);
                    predictions[i].push(y_hat);
                }
            }
        }

        let totalBiasSq = 0;
        let totalVariance = 0;
        for (let i = 0; i < NUM_TEST_POINTS; i++) {
            const pointPredictions = predictions[i];
            if (pointPredictions.length === 0) continue;
            const meanPrediction = pointPredictions.reduce((a, b) => a + b, 0) / pointPredictions.length;
            totalBiasSq += Math.pow(meanPrediction - trueValuesY[i], 2);
            totalVariance += pointPredictions.reduce((acc, pred) => acc + Math.pow(pred - meanPrediction, 2), 0) / pointPredictions.length;
        }

        return { bias: totalBiasSq / NUM_TEST_POINTS, variance: totalVariance / NUM_TEST_POINTS };
    }


    // 4. Draw everything on the canvas
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const mapX = (x) => CANVAS_PADDING + x * (canvas.width - 2 * CANVAS_PADDING);
        const mapY = (y) => canvas.height / 2 - y * (canvas.height / 2 - CANVAS_PADDING);

        ctx.beginPath();
        ctx.strokeStyle = TRUE_FN_COLOR;
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);
        for (let i = 0; i <= 100; i++) {
            const x = i / 100;
            const y = TRUE_FUNCTION(x);
            if (i === 0) ctx.moveTo(mapX(x), mapY(y));
            else ctx.lineTo(mapX(x), mapY(y));
        }
        ctx.stroke();
        ctx.setLineDash([]);

        ctx.fillStyle = DATA_POINT_COLOR;
        dataPoints.forEach(p => {
            ctx.beginPath();
            ctx.arc(mapX(p.x), mapY(p.y), 4, 0, 2 * Math.PI);
            ctx.fill();
        });

        if (modelCoefficients && modelCoefficients.length > 0) {
            ctx.beginPath();
            ctx.strokeStyle = MODEL_CURVE_COLOR;
            ctx.lineWidth = 3;
            for (let i = 0; i <= 100; i++) {
                const x = i / 100;
                let y = modelCoefficients.reduce((sum, coeff, j) => sum + coeff * Math.pow(x, j), 0);
                if (i === 0) ctx.moveTo(mapX(x), mapY(y));
                else ctx.lineTo(mapX(x), mapY(y));
            }
            ctx.stroke();
        }
    }

    // 5. Update UI text elements based on state
    function updateUI(metrics) {
        complexityValueSpan.textContent = `Degree: ${modelComplexity}`;
        noiseValueSpan.textContent = `Noise: ${parseFloat(noiseLevel).toFixed(2)}`;

        if (metrics) {
            biasValue.textContent = metrics.bias.toFixed(4);
            varianceValue.textContent = metrics.variance.toFixed(4);
        } else {
            biasValue.textContent = "Calculating...";
            varianceValue.textContent = "Calculating...";
        }

        let stateText;
        if (modelComplexity <= 4) {
            stateText = "HIGH BIAS (UNDERFITTING)";
            stateIndicator.style.color = SUBOPTIMAL_COLOR;
        } else if (modelComplexity >= 5 && modelComplexity <= 8) {
            stateText = "OPTIMAL TRADEOFF";
            stateIndicator.style.color = OPTIMAL_COLOR;
        } else {
            stateText = "HIGH VARIANCE (OVERFITTING)";
            stateIndicator.style.color = SUBOPTIMAL_COLOR;
        }
        stateIndicator.textContent = `CURRENT STATE: ${stateText}`;
    }

    // Combined update function
    async function runUpdate() {
        updateUI(null); // Show 'Calculating...'
        fitModel(); // Fit model on main data first for responsiveness
        draw();     // Draw immediately
        const metrics = await calculateBiasVariance(); // Calculate metrics in background
        updateUI(metrics); // Update UI again with metrics
    }

    // --- EVENT LISTENERS ---
    complexitySlider.addEventListener('input', (e) => {
        modelComplexity = parseInt(e.target.value);
        runUpdate();
    });
    noiseSlider.addEventListener('input', (e) => {
        noiseLevel = parseFloat(e.target.value);
        generateData(); // Generate new data for the main plot
        runUpdate();
    });
    newDataBtn.addEventListener('click', () => {
        generateData();
        runUpdate();
    });
    resetBtn.addEventListener('click', () => {
        modelComplexity = 3;
        noiseLevel = 0.2;
        complexitySlider.value = modelComplexity;
        noiseSlider.value = noiseLevel;
        generateData();
        runUpdate();
    });

    // --- INITIALIZATION ---
    function init() {
        const canvasContainer = canvas.parentElement;
        const style = getComputedStyle(canvasContainer);
        const paddingX = parseFloat(style.paddingLeft) + parseFloat(style.paddingRight);
        canvas.width = canvasContainer.clientWidth - paddingX;
        canvas.height = canvasContainer.clientHeight * 0.75;
        
        generateData();
        runUpdate();

        window.addEventListener('resize', () => {
            const newStyle = getComputedStyle(canvasContainer);
            const newPaddingX = parseFloat(newStyle.paddingLeft) + parseFloat(newStyle.paddingRight);
            canvas.width = canvasContainer.clientWidth - newPaddingX;
            canvas.height = canvasContainer.clientHeight * 0.75;
            draw();
        });
    }

    init();
});
</script>

</body>
</html>
