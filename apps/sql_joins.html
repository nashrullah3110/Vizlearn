<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZT6JM33V5J"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-ZT6JM33V5J');
        </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Joins Visualization</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --font-family: 'Roboto Mono', monospace;
            --bg-color: #101827;
            --controls-bg: #1f2937;
            --plot-bg: #1f2937;
            --text-color: #f3f4f6;
            --border-color: #374151;
            --accent-color: #8b5cf6;
            --accent-green: #10b981;
            --accent-blue: #3b82f6;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --footer-text-color: #9ca3af;
        }

        * {
            box-sizing: border-box;
            font-family: var(--font-family);
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: var(--controls-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem;
            text-align: center;
            flex-shrink: 0;
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            overflow-y: auto;
            gap: 1rem;
        }

        .controls-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            background-color: var(--controls-bg);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 500;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        select, button {
            padding: 0.6rem 1rem;
            font-size: 0.85rem;
            cursor: pointer;
            border: 1px solid var(--border-color);
            background-color: #374151;
            color: var(--text-color);
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            font-weight: 500;
        }

        button:hover, select:hover {
            background-color: #4b5563;
        }

        button.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .content-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            flex: 1;
        }

        .visualization-panel {
            background-color: var(--controls-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .tables-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            height: 100%;
        }

        .table-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .table-title {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--accent-blue);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--plot-bg);
            border-radius: 0.375rem;
            overflow: hidden;
            flex: 1;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.85rem;
        }

        .data-table th {
            background-color: #374151;
            font-weight: 600;
            color: var(--text-color);
        }

        .data-table tr.highlight-left {
            background-color: rgba(59, 130, 246, 0.2);
        }

        .data-table tr.highlight-right {
            background-color: rgba(16, 185, 129, 0.2);
        }

        .data-table tr.highlight-match {
            background-color: rgba(139, 92, 246, 0.3);
        }

        .venn-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .venn-title {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 1rem;
            text-align: center;
            color: var(--accent-color);
        }

        #venn-diagram {
            flex: 1;
            min-height: 300px;
        }

        .result-container {
            grid-column: 1 / -1;
            background-color: var(--controls-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .result-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--accent-green);
            text-align: center;
        }

        .sql-query {
            background-color: #111827;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9rem;
            color: #e5e7eb;
            white-space: pre-wrap;
        }

        .result-table-container {
            overflow-x: auto;
        }

        .explanation-box {
            background-color: #111827;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .explanation-box strong {
            color: var(--accent-green);
        }

        .footer {
            background-color: var(--controls-bg);
            border-top: 1px solid var(--border-color);
            width: 100%;
            padding: 2rem 1rem;
            flex-shrink: 0;
            text-align: center;
            color: var(--footer-text-color);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .footer-icon {
            transition: color 0.2s ease-in-out;
            color: var(--footer-text-color);
        }
        .footer-icon:hover {
            color: var(--accent-color);
        }

        @media (max-width: 768px) {
            .content-container {
                grid-template-columns: 1fr;
            }
            
            .controls-panel {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>

    <header class="header">
        <h1>SQL Joins Visualization</h1>
    </header>

    <main>
        <div class="controls-panel">
            <div class="control-group">
                <label for="join-type">Join Type:</label>
                <select id="join-type">
                    <option value="inner">INNER JOIN</option>
                    <option value="left">LEFT JOIN</option>
                    <option value="right">RIGHT JOIN</option>
                    <option value="full">FULL OUTER JOIN</option>
                    <option value="cross">CROSS JOIN</option>
                </select>
            </div>
            <div class="control-group">
                <label for="dataset-select">Dataset:</label>
                <select id="dataset-select">
                    <option value="employees-departments">Employees & Departments</option>
                    <option value="customers-orders">Customers & Orders</option>
                    <option value="students-courses">Students & Courses</option>
                </select>
            </div>
            <button id="animate-btn">Animate Join</button>
        </div>

        <div class="content-container">
            <div class="visualization-panel tables-container">
                <div class="table-section">
                    <div class="table-title" id="left-table-title">Left Table</div>
                    <table class="data-table" id="left-table">
                        <thead id="left-table-head"></thead>
                        <tbody id="left-table-body"></tbody>
                    </table>
                </div>
                <div class="table-section">
                    <div class="table-title" id="right-table-title">Right Table</div>
                    <table class="data-table" id="right-table">
                        <thead id="right-table-head"></thead>
                        <tbody id="right-table-body"></tbody>
                    </table>
                </div>
            </div>

            <div class="visualization-panel venn-container">
                <div class="venn-title" id="venn-title">INNER JOIN</div>
                <svg id="venn-diagram" viewBox="0 0 400 300"></svg>
            </div>

            <div class="result-container">
                <div class="result-title">Result</div>
                <div class="sql-query" id="sql-query"></div>
                <div class="result-table-container">
                    <table class="data-table" id="result-table">
                        <thead id="result-table-head"></thead>
                        <tbody id="result-table-body"></tbody>
                    </table>
                </div>
                <div class="explanation-box" id="explanation"></div>
            </div>
        </div>
    </main>
    
    <footer class="footer">
        <div class="footer-links">
            <a href="https://www.linkedin.com/in/ashish-jangra/" target="_blank" rel="noopener noreferrer" class="footer-icon">
                <i class="fab fa-linkedin fa-2x"></i>
            </a>
            <a href="https://github.com/AshishJangra27" target="_blank" rel="noopener noreferrer" class="footer-icon">
                <i class="fab fa-github fa-2x"></i>
            </a>
            <a href="https://www.kaggle.com/ashishjangra27" target="_blank" rel="noopener noreferrer" class="footer-icon">
                <i class="fab fa-kaggle fa-2x"></i>
            </a>
            <a href="https://huggingface.co/ashish-jangra" target="_blank" rel="noopener noreferrer" class="footer-icon">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block">
                    <path d="M20.24,12.2a8.24,8.24,0,1,1-16.48,0a8.24,8.24,0,0,1,16.48,0Z" fill="currentColor"></path>
                    <path d="M15.42,16.2c.18-.42.24-.84.18-1.26a4.55,4.55,0,0,0-.54-1.5a4.55,4.55,0,0,0-1.5-.54c-.42-.06-.84.06-1.26.18a4.55,4.55,0,0,0-1.5.54a4.55,4.55,0,0,0-.54,1.5c-.06.42.06.84.18,1.26a4.55,4.55,0,0,0,.54,1.5,4.55,4.55,0,0,0,1.5.54c.42.06.84,0,1.26-.18a4.55,4.55,0,0,0,1.5-.54,4.55,4.55,0,0,0,.54-1.5Z" fill="#101827"></path>
                    <path d="M10.26,10.26a1.44,1.44,0,1,1-2.88,0,1.44,1.44,0,0,1,2.88,0" fill="#101827"></path>
                    <path d="M16.62,10.26a1.44,1.44,0,1,1-2.88,0,1.44,1.44,0,0,1,2.88,0" fill="#101827"></path>
                </svg>
            </a>
            <a href="https://www.instagram.com/ashish_zangra/" target="_blank" rel="noopener noreferrer" class="footer-icon">
                <i class="fab fa-instagram fa-2x"></i>
            </a>
        </div>
        <p>&copy; 2024 vizlearn. All Rights Reserved.</p>
    </footer>

    <script>
        // --- DOM Elements ---
        const joinTypeSelect = document.getElementById('join-type');
        const datasetSelect = document.getElementById('dataset-select');
        const animateBtn = document.getElementById('animate-btn');
        
        const leftTableTitle = document.getElementById('left-table-title');
        const rightTableTitle = document.getElementById('right-table-title');
        const leftTableHead = document.getElementById('left-table-head');
        const leftTableBody = document.getElementById('left-table-body');
        const rightTableHead = document.getElementById('right-table-head');
        const rightTableBody = document.getElementById('right-table-body');
        
        const vennTitle = document.getElementById('venn-title');
        const vennDiagram = document.getElementById('venn-diagram');
        
        const sqlQuery = document.getElementById('sql-query');
        const resultTableHead = document.getElementById('result-table-head');
        const resultTableBody = document.getElementById('result-table-body');
        const explanation = document.getElementById('explanation');

        // --- Data Sets ---
        const datasets = {
            'employees-departments': {
                leftTable: {
                    name: 'employees',
                    title: 'Employees Table',
                    columns: ['emp_id', 'name', 'dept_id', 'salary'],
                    data: [
                        [1, 'John Doe', 101, 50000],
                        [2, 'Jane Smith', 102, 60000],
                        [3, 'Bob Johnson', 101, 55000],
                        [4, 'Alice Brown', 103, 65000],
                        [5, 'Charlie Davis', 999, 45000]
                    ]
                },
                rightTable: {
                    name: 'departments',
                    title: 'Departments Table',
                    columns: ['dept_id', 'dept_name', 'location'],
                    data: [
                        [101, 'Engineering', 'New York'],
                        [102, 'Marketing', 'Los Angeles'],
                        [103, 'Sales', 'Chicago'],
                        [104, 'HR', 'Boston']
                    ]
                },
                joinKey: 'dept_id'
            },
            'customers-orders': {
                leftTable: {
                    name: 'customers',
                    title: 'Customers Table',
                    columns: ['customer_id', 'customer_name', 'email'],
                    data: [
                        [1, 'Anna Wilson', 'anna@email.com'],
                        [2, 'Mark Taylor', 'mark@email.com'],
                        [3, 'Sarah Connor', 'sarah@email.com'],
                        [4, 'Tom Hardy', 'tom@email.com']
                    ]
                },
                rightTable: {
                    name: 'orders',
                    title: 'Orders Table',
                    columns: ['order_id', 'customer_id', 'product', 'amount'],
                    data: [
                        [101, 1, 'Laptop', 1200],
                        [102, 2, 'Mouse', 25],
                        [103, 1, 'Keyboard', 80],
                        [104, 5, 'Monitor', 300],
                        [105, 2, 'Headphones', 150]
                    ]
                },
                joinKey: 'customer_id'
            },
            'students-courses': {
                leftTable: {
                    name: 'students',
                    title: 'Students Table',
                    columns: ['student_id', 'student_name', 'major'],
                    data: [
                        [1, 'Emily Clark', 'Computer Science'],
                        [2, 'Michael Brown', 'Mathematics'],
                        [3, 'Jessica Lee', 'Physics'],
                        [4, 'David Kim', 'Chemistry']
                    ]
                },
                rightTable: {
                    name: 'enrollments',
                    title: 'Enrollments Table',
                    columns: ['enrollment_id', 'student_id', 'course_name', 'grade'],
                    data: [
                        [1, 1, 'Data Structures', 'A'],
                        [2, 2, 'Calculus', 'B+'],
                        [3, 1, 'Algorithms', 'A-'],
                        [4, 5, 'Statistics', 'B'],
                        [5, 3, 'Quantum Physics', 'A+']
                    ]
                },
                joinKey: 'student_id'
            }
        };

        // --- State Variables ---
        let currentDataset = 'employees-departments';
        let currentJoinType = 'inner';
        let isAnimating = false;

        // --- Helper Functions ---
        function createTableHTML(table, isLeft = true) {
            const headHTML = table.columns.map(col => `<th>${col}</th>`).join('');
            const bodyHTML = table.data.map((row, index) => 
                `<tr data-row="${index}">${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`
            ).join('');
            
            return { headHTML, bodyHTML };
        }

        function performJoin(leftData, rightData, joinKey, joinType) {
            const leftJoinCol = leftData.columns.indexOf(joinKey);
            const rightJoinCol = rightData.columns.indexOf(joinKey);
            let result = [];

            switch (joinType) {
                case 'inner':
                    leftData.data.forEach(leftRow => {
                        rightData.data.forEach(rightRow => {
                            if (leftRow[leftJoinCol] === rightRow[rightJoinCol]) {
                                result.push([...leftRow, ...rightRow.filter((_, i) => i !== rightJoinCol)]);
                            }
                        });
                    });
                    break;

                case 'left':
                    leftData.data.forEach(leftRow => {
                        const matches = rightData.data.filter(rightRow => 
                            leftRow[leftJoinCol] === rightRow[rightJoinCol]
                        );
                        if (matches.length > 0) {
                            matches.forEach(rightRow => {
                                result.push([...leftRow, ...rightRow.filter((_, i) => i !== rightJoinCol)]);
                            });
                        } else {
                            const nullRightCols = new Array(rightData.columns.length - 1).fill('NULL');
                            result.push([...leftRow, ...nullRightCols]);
                        }
                    });
                    break;

                case 'right':
                    rightData.data.forEach(rightRow => {
                        const matches = leftData.data.filter(leftRow => 
                            leftRow[leftJoinCol] === rightRow[rightJoinCol]
                        );
                        if (matches.length > 0) {
                            matches.forEach(leftRow => {
                                result.push([...leftRow, ...rightRow.filter((_, i) => i !== rightJoinCol)]);
                            });
                        } else {
                            const nullLeftCols = new Array(leftData.columns.length).fill('NULL');
                            result.push([...nullLeftCols, ...rightRow.filter((_, i) => i !== rightJoinCol)]);
                        }
                    });
                    break;

                case 'full':
                    // Collect all matches
                    const usedRightRows = new Set();
                    leftData.data.forEach(leftRow => {
                        const matches = rightData.data.filter((rightRow, index) => {
                            if (leftRow[leftJoinCol] === rightRow[rightJoinCol]) {
                                usedRightRows.add(index);
                                return true;
                            }
                            return false;
                        });
                        if (matches.length > 0) {
                            matches.forEach(rightRow => {
                                result.push([...leftRow, ...rightRow.filter((_, i) => i !== rightJoinCol)]);
                            });
                        } else {
                            const nullRightCols = new Array(rightData.columns.length - 1).fill('NULL');
                            result.push([...leftRow, ...nullRightCols]);
                        }
                    });
                    // Add unmatched right rows
                    rightData.data.forEach((rightRow, index) => {
                        if (!usedRightRows.has(index)) {
                            const nullLeftCols = new Array(leftData.columns.length).fill('NULL');
                            result.push([...nullLeftCols, ...rightRow.filter((_, i) => i !== rightJoinCol)]);
                        }
                    });
                    break;

                case 'cross':
                    leftData.data.forEach(leftRow => {
                        rightData.data.forEach(rightRow => {
                            result.push([...leftRow, ...rightRow]);
                        });
                    });
                    break;
            }

            return result;
        }

        function generateSQL(joinType, leftTable, rightTable, joinKey) {
            const queries = {
                'inner': `SELECT *\nFROM ${leftTable} l\nINNER JOIN ${rightTable} r\n  ON l.${joinKey} = r.${joinKey};`,
                'left': `SELECT *\nFROM ${leftTable} l\nLEFT JOIN ${rightTable} r\n  ON l.${joinKey} = r.${joinKey};`,
                'right': `SELECT *\nFROM ${leftTable} l\nRIGHT JOIN ${rightTable} r\n  ON l.${joinKey} = r.${joinKey};`,
                'full': `SELECT *\nFROM ${leftTable} l\nFULL OUTER JOIN ${rightTable} r\n  ON l.${joinKey} = r.${joinKey};`,
                'cross': `SELECT *\nFROM ${leftTable} l\nCROSS JOIN ${rightTable} r;`
            };
            return queries[joinType];
        }

        function getJoinExplanation(joinType) {
            const explanations = {
                'inner': '<strong>INNER JOIN</strong> returns only the rows that have matching values in both tables. Records that don\'t have a match in the other table are excluded from the result.',
                'left': '<strong>LEFT JOIN</strong> returns all rows from the left table and the matched rows from the right table. If no match is found, NULL values are returned for the right table columns.',
                'right': '<strong>RIGHT JOIN</strong> returns all rows from the right table and the matched rows from the left table. If no match is found, NULL values are returned for the left table columns.',
                'full': '<strong>FULL OUTER JOIN</strong> returns all rows when there is a match in either left or right table. Records with no match in either table will have NULL values for the missing side.',
                'cross': '<strong>CROSS JOIN</strong> returns the Cartesian product of both tables - every row from the left table is combined with every row from the right table.'
            };
            return explanations[joinType];
        }

        function drawVennDiagram(joinType) {
            vennDiagram.innerHTML = '';
            
            const leftCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            const rightCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            
            leftCircle.setAttribute('cx', '150');
            leftCircle.setAttribute('cy', '150');
            leftCircle.setAttribute('r', '80');
            leftCircle.setAttribute('stroke', '#3b82f6');
            leftCircle.setAttribute('stroke-width', '3');
            leftCircle.setAttribute('fill', 'transparent');
            
            rightCircle.setAttribute('cx', '250');
            rightCircle.setAttribute('cy', '150');
            rightCircle.setAttribute('r', '80');
            rightCircle.setAttribute('stroke', '#10b981');
            rightCircle.setAttribute('stroke-width', '3');
            rightCircle.setAttribute('fill', 'transparent');

            // Add labels
            const leftLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            leftLabel.setAttribute('x', '100');
            leftLabel.setAttribute('y', '100');
            leftLabel.setAttribute('fill', '#3b82f6');
            leftLabel.setAttribute('font-size', '14');
            leftLabel.setAttribute('font-weight', 'bold');
            leftLabel.textContent = datasets[currentDataset].leftTable.title.split(' ')[0];

            const rightLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            rightLabel.setAttribute('x', '280');
            rightLabel.setAttribute('y', '100');
            rightLabel.setAttribute('fill', '#10b981');
            rightLabel.setAttribute('font-size', '14');
            rightLabel.setAttribute('font-weight', 'bold');
            rightLabel.textContent = datasets[currentDataset].rightTable.title.split(' ')[0];

            // Highlight based on join type
            switch (joinType) {
                case 'inner':
                    // Intersection
                    const intersection = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    intersection.setAttribute('d', 'M 200 90 A 80 80 0 0 1 200 210 A 80 80 0 0 1 200 90');
                    intersection.setAttribute('fill', 'rgba(139, 92, 246, 0.5)');
                    vennDiagram.appendChild(intersection);
                    break;
                case 'left':
                    leftCircle.setAttribute('fill', 'rgba(59, 130, 246, 0.3)');
                    break;
                case 'right':
                    rightCircle.setAttribute('fill', 'rgba(16, 185, 129, 0.3)');
                    break;
                case 'full':
                    leftCircle.setAttribute('fill', 'rgba(59, 130, 246, 0.2)');
                    rightCircle.setAttribute('fill', 'rgba(16, 185, 129, 0.2)');
                    break;
                case 'cross':
                    // Draw a grid pattern to represent cartesian product
                    for (let i = 0; i < 5; i++) {
                        for (let j = 0; j < 5; j++) {
                            const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                            dot.setAttribute('cx', 120 + i * 40);
                            dot.setAttribute('cy', 120 + j * 20);
                            dot.setAttribute('r', '3');
                            dot.setAttribute('fill', '#8b5cf6');
                            vennDiagram.appendChild(dot);
                        }
                    }
                    break;
            }

            vennDiagram.appendChild(leftCircle);
            vennDiagram.appendChild(rightCircle);
            vennDiagram.appendChild(leftLabel);
            vennDiagram.appendChild(rightLabel);
        }

        function clearHighlights() {
            document.querySelectorAll('.data-table tr').forEach(row => {
                row.classList.remove('highlight-left', 'highlight-right', 'highlight-match');
            });
        }

        function updateVisualization() {
            const dataset = datasets[currentDataset];
            const { leftTable, rightTable, joinKey } = dataset;

            // Update table titles
            leftTableTitle.textContent = leftTable.title;
            rightTableTitle.textContent = rightTable.title;

            // Update tables
            const leftHTML = createTableHTML(leftTable, true);
            const rightHTML = createTableHTML(rightTable, false);
            
            leftTableHead.innerHTML = leftHTML.headHTML;
            leftTableBody.innerHTML = leftHTML.bodyHTML;
            rightTableHead.innerHTML = rightHTML.headHTML;
            rightTableBody.innerHTML = rightHTML.bodyHTML;

            // Perform join
            const resultData = performJoin(leftTable, rightTable, joinKey, currentJoinType);
            
            // Create result columns
            let resultColumns = [...leftTable.columns];
            if (currentJoinType === 'cross') {
                resultColumns = [...leftTable.columns, ...rightTable.columns];
            } else {
                resultColumns = [...leftTable.columns, ...rightTable.columns.filter(col => col !== joinKey)];
            }

            // Update result table
            const resultHeadHTML = resultColumns.map(col => `<th>${col}</th>`).join('');
            const resultBodyHTML = resultData.map(row => 
                `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`
            ).join('');
            
            resultTableHead.innerHTML = resultHeadHTML;
            resultTableBody.innerHTML = resultBodyHTML;

            // Update SQL query
            sqlQuery.textContent = generateSQL(currentJoinType, leftTable.name, rightTable.name, joinKey);

            // Update explanation
            explanation.innerHTML = getJoinExplanation(currentJoinType);

            // Update Venn diagram
            drawVennDiagram(currentJoinType);
            vennTitle.textContent = joinTypeSelect.options[joinTypeSelect.selectedIndex].text;

            clearHighlights();
        }

        async function animateJoin() {
            if (isAnimating) return;
            isAnimating = true;
            animateBtn.textContent = 'Animating...';
            animateBtn.disabled = true;

            clearHighlights();
            
            const dataset = datasets[currentDataset];
            const { leftTable, rightTable, joinKey } = dataset;
            const leftJoinCol = leftTable.columns.indexOf(joinKey);
            const rightJoinCol = rightTable.columns.indexOf(joinKey);

            // Animate through each left table row
            for (let i = 0; i < leftTable.data.length; i++) {
                const leftRow = document.querySelector(`#left-table-body tr[data-row="${i}"]`);
                leftRow.classList.add('highlight-left');

                await new Promise(resolve => setTimeout(resolve, 800));

                // Find matching rows in right table
                const leftValue = leftTable.data[i][leftJoinCol];
                const matchingRightRows = [];
                
                for (let j = 0; j < rightTable.data.length; j++) {
                    if (rightTable.data[j][rightJoinCol] === leftValue) {
                        matchingRightRows.push(j);
                        const rightRow = document.querySelector(`#right-table-body tr[data-row="${j}"]`);
                        rightRow.classList.add('highlight-right');
                    }
                }

                await new Promise(resolve => setTimeout(resolve, 800));

                if (matchingRightRows.length > 0 || currentJoinType === 'left' || currentJoinType === 'full') {
                    leftRow.classList.add('highlight-match');
                    matchingRightRows.forEach(j => {
                        const rightRow = document.querySelector(`#right-table-body tr[data-row="${j}"]`);
                        rightRow.classList.add('highlight-match');
                    });
                }

                await new Promise(resolve => setTimeout(resolve, 500));
            }

            // For right join and full join, highlight unmatched right rows
            if (currentJoinType === 'right' || currentJoinType === 'full') {
                const leftJoinValues = new Set(leftTable.data.map(row => row[leftJoinCol]));
                
                for (let j = 0; j < rightTable.data.length; j++) {
                    const rightValue = rightTable.data[j][rightJoinCol];
                    if (!leftJoinValues.has(rightValue)) {
                        const rightRow = document.querySelector(`#right-table-body tr[data-row="${j}"]`);
                        rightRow.classList.add('highlight-right');
                        await new Promise(resolve => setTimeout(resolve, 300));
                        rightRow.classList.add('highlight-match');
                    }
                }
            }

            isAnimating = false;
            animateBtn.textContent = 'Animate Join';
            animateBtn.disabled = false;
        }

        // --- Event Listeners ---
        joinTypeSelect.addEventListener('change', (e) => {
            currentJoinType = e.target.value;
            updateVisualization();
        });

        datasetSelect.addEventListener('change', (e) => {
            currentDataset = e.target.value;
            updateVisualization();
        });

        animateBtn.addEventListener('click', animateJoin);

        // --- Initialization ---
        updateVisualization();
    </script>

</body>
</html>